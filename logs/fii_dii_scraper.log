2025-06-22 07:38:33.047 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 07:38:33.049 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 07:38:33.358 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:541 - 🚀 Starting FII/DII tracker
2025-06-22 07:38:33.360 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:33.360 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:475 - Trying official API...
2025-06-22 07:38:33.361 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: Mock object has no attribute 'headers'
2025-06-22 07:38:33.361 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:479 - API failed, trying Playwright...
2025-06-22 07:38:33.546 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:541 - 🚀 Starting FII/DII tracker
2025-06-22 07:38:33.547 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:33.548 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:475 - Trying official API...
2025-06-22 07:38:33.548 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: Mock object has no attribute 'headers'
2025-06-22 07:38:33.549 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:479 - API failed, trying Playwright...
2025-06-22 07:38:33.639 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:541 - 🚀 Starting FII/DII tracker
2025-06-22 07:38:33.687 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:541 - 🚀 Starting FII/DII tracker
2025-06-22 07:38:33.687 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:35.787 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:533 - Updated 2 records
2025-06-22 07:38:35.790 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:550 - ✅ Tracker completed in 2.10 seconds
2025-06-22 07:38:35.792 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:553 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:38:35.820 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:574 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:38:35.870 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:541 - 🚀 Starting FII/DII tracker
2025-06-22 07:38:35.871 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:35.875 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:550 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:38:35.875 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:553 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 07:38:35.906 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:574 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:38:35.920 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:541 - 🚀 Starting FII/DII tracker
2025-06-22 07:38:35.921 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:550 - ✅ Tracker completed in 2.50 seconds
2025-06-22 07:38:35.922 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:553 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:38:35.922 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:566 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 07:38:35.948 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:541 - 🚀 Starting FII/DII tracker
2025-06-22 07:38:35.949 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:548 - Scraping failed completely
2025-06-22 07:38:35.950 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:550 - ✅ Tracker completed in 1.00 seconds
2025-06-22 07:38:35.978 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:541 - 🚀 Starting FII/DII tracker
2025-06-22 07:38:35.979 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:550 - ✅ Tracker completed in 1.50 seconds
2025-06-22 07:38:35.980 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:553 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:38:35.981 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:566 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 07:38:36.001 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.007 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: Mock object has no attribute 'headers'
2025-06-22 07:38:36.029 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.055 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.259 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.287 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.418 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.426 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:38:36.541 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.545 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:475 - Trying official API...
2025-06-22 07:38:36.556 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.560 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:475 - Trying official API...
2025-06-22 07:38:36.561 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:479 - API failed, trying Playwright...
2025-06-22 07:38:36.566 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.574 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:483 - All scraping methods failed, using mock data
2025-06-22 07:38:36.698 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.708 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 07:38:36.714 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.720 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:38:36.728 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.734 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:38:36.740 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.746 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:38:36.753 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.758 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:38:36.763 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.765 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:38:36.766 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:38:36.766 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:38:36.767 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:38:36.773 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.774 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 07:38:36.775 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 07:38:36.780 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.785 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:38:36.790 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.794 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:38:36.800 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.805 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:38:36.810 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.867 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.874 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.876 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:466 - Generated 3 days of mock data
2025-06-22 07:38:36.876 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:467 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:38:36.883 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.884 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:466 - Generated 3 days of mock data
2025-06-22 07:38:36.885 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:467 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:38:36.890 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:36.899 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:533 - Updated 1 records
2025-06-22 07:38:37.040 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:37.045 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:489 - No data to update
2025-06-22 07:38:37.052 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:37.080 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:38:37.088 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:533 - Updated 1 records
2025-06-22 07:38:37.123 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:541 - 🚀 Starting FII/DII tracker
2025-06-22 07:38:37.165 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:43:29.781 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 07:43:29.782 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 07:44:09.506 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 07:44:09.507 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 07:44:55.250 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 07:44:55.251 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 07:44:55.524 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:44:55.525 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:55.526 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:44:55.526 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: Mock object has no attribute 'headers'
2025-06-22 07:44:55.526 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:44:55.527 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:44:55.527 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 07:44:55.528 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/1.1
2025-06-22 07:44:55.528 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 07:44:55.528 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:317 - Retry 1/1 in 0.02s
2025-06-22 07:44:55.549 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:319 - Playwright scraping failed after all attempts
2025-06-22 07:44:55.550 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:44:55.551 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:44:55.552 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:44:57.491 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 07:44:57.499 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.97 seconds
2025-06-22 07:44:57.501 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 4484.67    ┆ 1859.24     ┆ 2625.43    ┆ 3469.39    ┆ 2941.91     ┆ 527.48     │
│ 2025-06-19 ┆ 2245.11    ┆ 7249.02     ┆ -5003.91   ┆ 3228.14    ┆ 2674.19     ┆ 553.95     │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:44:57.542 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:44:57.758 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:44:57.759 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:57.760 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:44:57.760 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: Mock object has no attribute 'headers'
2025-06-22 07:44:57.760 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:44:57.761 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:44:57.777 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7f818db39ee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7f818dabbce0: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7f818db39d00>
           └ <coverage.cmdline.CoverageScript object at 0x7f818dabaed0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7f818db391c0>
    └ <coverage.execfile.PyRunner object at 0x7f818df3f410>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7f818d15e670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7f818d382160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7f818e6cd940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7f818d36dbe0>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f818d183fe0>
         │                └ <_pytest.config.Config object at 0x7f818d36dbe0>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7f818d36dbe0>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7f818d36dbe0>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7f818d972ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f818d5c56d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7f818d36dbe0>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7f818d4507c0>
           │            └ <_pytest.config.Config object at 0x7f818d36dbe0>
           └ <function wrap_session at 0x7f818d450400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7f818d36dbe0>
    │       │            └ <function _main at 0x7f818d4507c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f818d183fe0>
    └ <_pytest.config.Config object at 0x7f818d36dbe0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7f818d972ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f818d5c56d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7f818d972ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f818d5c56d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7f818d43f7e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7f818d43fd80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7f818d4500e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7f817c89a8e0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7f818d972ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f818d5c56d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7f818cbd0e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7f818d3ae110>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7f818d972ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f818d5c56d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7f817c8fa9c0>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7f817c89b380>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7f818cec1620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f818cec1580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f818cec3380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f818ce57880>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f815c873ee0>()>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f815c873ee0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f815c873ee0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f815c873ee0>()>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 164, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7f817c873e20>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7f817c8739c0>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f815ca1f530>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7f817c873ba0>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f815ca1f530>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7f817c873b00>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f815ca1f530>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7f81859fa0c0>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7f81863bbb00>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f815c6a71d0>}
           │         └ (<LazyFrame at 0x7F815CF23860>,)
           └ <function LazyFrame.collect at 0x7f818599c9a0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f817c87c7a0>}
           │         └ (<LazyFrame at 0x7F815CF23860>,)
           └ <function LazyFrame.collect at 0x7f818599c900>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7f815c9abc50>
           └ <function wrap_df at 0x7f818635b600>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 07:44:57.851 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:44:57.851 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:44:57.852 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:44:57.891 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 07:44:57.897 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.14 seconds
2025-06-22 07:44:57.898 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 4080.21    ┆ 4611.19     ┆ -530.98    ┆ 3946.07    ┆ 2826.34     ┆ 1119.73    │
│ 2025-06-19 ┆ 6814.63    ┆ 3707.23     ┆ 3107.4     ┆ 2291.16    ┆ 2087.75     ┆ 203.41     │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:44:57.925 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:44:57.998 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:44:57.999 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:57.999 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:44:58.000 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:44:58.000 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:44:58.001 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:44:58.001 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 07:44:58.030 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:44:58.057 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:44:58.058 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:58.067 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmpityh8sg7.db" exists, but it is not a valid DuckDB database file!
2025-06-22 07:44:58.067 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 07:44:58.068 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:44:58.074 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpityh8sg7.db" exists, but it is not a valid DuckDB database file!
2025-06-22 07:44:58.101 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:44:58.102 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:58.105 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:44:58.105 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 07:44:58.138 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:44:58.165 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:44:58.172 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 07:44:58.177 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:44:58.183 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 07:44:58.225 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:44:58.230 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 07:44:58.235 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 07:44:58.279 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:44:58.284 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 07:44:58.290 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:44:58.297 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 07:44:58.323 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:58.520 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:58.735 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:58.861 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:58.985 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.109 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.119 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:44:59.320 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.325 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:44:59.334 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.339 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:44:59.340 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:44:59.346 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.352 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:44:59.352 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:44:59.362 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.372 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 07:44:59.379 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.385 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:44:59.393 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.399 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:44:59.407 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.414 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:44:59.421 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.428 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:44:59.434 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.435 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:44:59.436 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:44:59.437 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:44:59.438 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:44:59.444 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.445 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 07:44:59.446 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 07:44:59.452 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.457 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:44:59.463 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.468 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:44:59.474 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.479 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:44:59.487 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.574 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.582 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.584 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:44:59.585 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:44:59.593 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.595 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:44:59.595 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:44:59.602 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.612 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 07:44:59.737 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.743 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 07:44:59.750 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.759 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.768 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 07:44:59.804 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:44:59.806 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.806 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:44:59.807 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:44:59.807 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:44:59.808 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:44:59.809 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 07:44:59.839 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:44:59.858 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:44:59.868 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 07:45:34.252 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 07:45:34.253 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 07:45:34.723 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:45:34.724 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:34.725 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:45:34.725 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: Mock object has no attribute 'headers'
2025-06-22 07:45:34.726 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:45:34.729 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:45:34.731 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 07:45:34.731 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/1.1
2025-06-22 07:45:34.731 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 07:45:34.732 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:317 - Retry 1/1 in 0.02s
2025-06-22 07:45:34.753 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:319 - Playwright scraping failed after all attempts
2025-06-22 07:45:34.754 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:45:34.759 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:45:34.759 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:45:37.709 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 07:45:37.718 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.99 seconds
2025-06-22 07:45:37.721 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 3942.3     ┆ 7039.47     ┆ -3097.17   ┆ 2441.69    ┆ 3194.87     ┆ -753.18    │
│ 2025-06-19 ┆ 7073.31    ┆ 1809.55     ┆ 5263.76    ┆ 3847.77    ┆ 3479.83     ┆ 367.94     │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:45:37.782 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:45:38.235 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:45:38.240 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:38.242 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:45:38.243 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: Mock object has no attribute 'headers'
2025-06-22 07:45:38.243 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:45:38.245 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:45:38.284 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7f605d6f5ee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7f605d673e00: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7f605d6f5d00>
           └ <coverage.cmdline.CoverageScript object at 0x7f605d672f30>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7f605d6f51c0>
    └ <coverage.execfile.PyRunner object at 0x7f605d6734d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7f605cd16670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7f605cf3e160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7f605e285940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7f605d45fc50>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f605cd3be90>
         │                └ <_pytest.config.Config object at 0x7f605d45fc50>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7f605d45fc50>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7f605d45fc50>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7f605d52aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f605d709a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7f605d45fc50>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7f605d0087c0>
           │            └ <_pytest.config.Config object at 0x7f605d45fc50>
           └ <function wrap_session at 0x7f605d008400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7f605d45fc50>
    │       │            └ <function _main at 0x7f605d0087c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f605cd3be90>
    └ <_pytest.config.Config object at 0x7f605d45fc50>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7f605d52aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f605d709a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7f605d52aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f605d709a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7f605cff77e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7f605cff7d80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7f605d0080e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7f60540468e0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7f605d52aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f605d709a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7f605c788e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7f605cf66110>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7f605d52aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f605d709a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7f60540a99a0>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7f6054047380>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7f605ca81620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f605ca81580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f605ca83380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f605ca13880>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f60540a86a0>()>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f60540a86a0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f60540a86a0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f60540a86a0>()>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 164, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7f605401be20>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7f605401b9c0>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f6013b5e030>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7f605401bba0>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f6013b5e030>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7f605401bb00>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f6013b5e030>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7f60555fa0c0>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7f6055fbbb00>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f6013913680>}
           │         └ (<LazyFrame at 0x7F60139136B0>,)
           └ <function LazyFrame.collect at 0x7f605559c9a0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f60139135f0>}
           │         └ (<LazyFrame at 0x7F60139136B0>,)
           └ <function LazyFrame.collect at 0x7f605559c900>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7f6013bcb5d0>
           └ <function wrap_df at 0x7f6055f5b600>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 07:45:38.345 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:45:38.346 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:45:38.346 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:45:38.377 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 07:45:38.385 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.15 seconds
2025-06-22 07:45:38.386 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 7293.21    ┆ 5865.75     ┆ 1427.46    ┆ 3008.92    ┆ 1473.72     ┆ 1535.2     │
│ 2025-06-19 ┆ 6095.23    ┆ 2316.57     ┆ 3778.66    ┆ 1779.43    ┆ 3796.47     ┆ -2017.04   │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:45:38.426 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:45:38.538 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:45:38.543 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:38.543 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:45:38.544 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:45:38.544 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:45:38.545 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:45:38.545 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 07:45:38.602 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:45:38.658 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:45:38.660 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:38.669 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmpv9a7r0xw.db" exists, but it is not a valid DuckDB database file!
2025-06-22 07:45:38.669 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 07:45:38.670 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:45:38.679 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpv9a7r0xw.db" exists, but it is not a valid DuckDB database file!
2025-06-22 07:45:38.739 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:45:38.743 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:38.748 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 07:45:38.749 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 07:45:38.807 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:45:38.866 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:45:38.879 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 07:45:38.893 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:45:38.906 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 07:45:38.980 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:45:38.993 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 07:45:39.002 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 07:45:39.087 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:45:39.099 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 07:45:39.111 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:45:39.129 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 07:45:39.177 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:39.193 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:45:39.199 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 07:45:39.238 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:39.254 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:45:39.259 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 07:45:39.494 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:39.523 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:45:39.526 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 07:45:39.750 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:39.773 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:45:39.778 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 07:45:40.008 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.024 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:45:40.070 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.083 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:45:40.441 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.448 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:45:40.457 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.463 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:45:40.467 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:45:40.480 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.490 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:45:40.491 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:45:40.504 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.517 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 07:45:40.531 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.548 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:45:40.562 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.577 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:45:40.590 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.601 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:45:40.705 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.718 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:45:40.729 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.734 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:45:40.737 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:45:40.738 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:45:40.740 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:45:40.749 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.750 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 07:45:40.751 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 07:45:40.760 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.769 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:45:40.777 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.791 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:45:40.802 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.814 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:45:40.826 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.859 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.873 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.876 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:45:40.877 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:45:40.895 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.898 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:45:40.899 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:45:40.908 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:40.930 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 07:45:41.170 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:41.179 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 07:45:41.190 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:41.205 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:41.225 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 07:45:41.303 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:45:41.305 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:41.307 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:45:41.308 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:45:41.309 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:45:41.309 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 07:45:41.310 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 07:45:41.358 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:45:41.401 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:45:41.415 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 07:55:33.396 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 07:55:33.397 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 07:55:33.700 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:55:33.701 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:33.701 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:55:33.702 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:55:33.707 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: type object 'NSE_FII_DII_Scraper' has no attribute 'HOME_URL'
2025-06-22 07:55:33.707 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:55:33.708 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:55:33.708 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 07:55:33.709 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/1.1
2025-06-22 07:55:33.709 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 07:55:33.709 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:317 - Retry 1/1 in 0.02s
2025-06-22 07:55:33.730 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:319 - Playwright scraping failed after all attempts
2025-06-22 07:55:33.731 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:55:33.733 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:55:33.734 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:55:35.893 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 07:55:35.898 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.20 seconds
2025-06-22 07:55:35.904 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 4438.68    ┆ 6120.37     ┆ -1681.69   ┆ 3237.48    ┆ 2930.9      ┆ 306.58     │
│ 2025-06-19 ┆ 3986.47    ┆ 4419.3      ┆ -432.83    ┆ 2584.06    ┆ 2386.27     ┆ 197.79     │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:55:35.938 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:55:36.124 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:55:36.124 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.125 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:55:36.125 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:55:36.128 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: type object 'NSE_FII_DII_Scraper' has no attribute 'HOME_URL'
2025-06-22 07:55:36.129 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:55:36.129 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:55:36.149 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7fc2d1a69ee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7fc2d19e7e00: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7fc2d1a69d00>
           └ <coverage.cmdline.CoverageScript object at 0x7fc2d19e6f30>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7fc2d1a691c0>
    └ <coverage.execfile.PyRunner object at 0x7fc2d19e74d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7fc2d108a670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7fc2d12b2160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7fc2d25f9940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7fc2d17d3c50>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fc2d1299e20>
         │                └ <_pytest.config.Config object at 0x7fc2d17d3c50>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7fc2d17d3c50>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7fc2d17d3c50>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7fc2d189eca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fc2d1a7d850>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7fc2d17d3c50>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7fc2d137c7c0>
           │            └ <_pytest.config.Config object at 0x7fc2d17d3c50>
           └ <function wrap_session at 0x7fc2d137c400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7fc2d17d3c50>
    │       │            └ <function _main at 0x7fc2d137c7c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fc2d1299e20>
    └ <_pytest.config.Config object at 0x7fc2d17d3c50>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7fc2d189eca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fc2d1a7d850>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7fc2d189eca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fc2d1a7d850>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7fc2d136b7e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7fc2d136bd80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7fc2d137c0e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7fc2c089aa20>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7fc2d189eca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fc2d1a7d850>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7fc2d0afce00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7fc2d12da110>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7fc2d189eca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fc2d1a7d850>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7fc2c8be6fc0>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7fc2c08cc720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7fc2d0df5620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fc2d0df5580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fc2d0df7380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fc2d0d8b880>
    └ <Handle Task.task_wakeup(<Future finis... 'HOME_URL'")>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... 'HOME_URL'")>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... 'HOME_URL'")>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... 'HOME_URL'")>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 166, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7fc2c0873e20>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7fc2c08739c0>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fc2981e4ce0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7fc2c0873ba0>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fc2981e4ce0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7fc2c0873b00>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fc2981e4ce0>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7fc2c99fa0c0>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7fc2ca343b00>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7fc28bd33e60>}
           │         └ (<LazyFrame at 0x7FC28BD33D70>,)
           └ <function LazyFrame.collect at 0x7fc2c99a09a0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7fc28bd33f50>}
           │         └ (<LazyFrame at 0x7FC28BD33D70>,)
           └ <function LazyFrame.collect at 0x7fc2c99a0900>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7fc298177c50>
           └ <function wrap_df at 0x7fc2ca2e3600>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 07:55:36.220 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:55:36.221 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:55:36.221 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:55:36.253 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 07:55:36.256 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.13 seconds
2025-06-22 07:55:36.257 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 2607.84    ┆ 4632.31     ┆ -2024.47   ┆ 2472.21    ┆ 2608.29     ┆ -136.08    │
│ 2025-06-19 ┆ 6905.77    ┆ 3926.64     ┆ 2979.13    ┆ 3575.05    ┆ 1883.91     ┆ 1691.14    │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:55:36.283 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:55:36.337 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:55:36.338 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.338 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:55:36.339 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:55:36.339 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:55:36.340 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:55:36.340 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 07:55:36.366 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:55:36.393 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:55:36.394 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.402 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmp0xxmr_d6.db" exists, but it is not a valid DuckDB database file!
2025-06-22 07:55:36.403 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 07:55:36.403 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:55:36.409 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmp0xxmr_d6.db" exists, but it is not a valid DuckDB database file!
2025-06-22 07:55:36.433 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:55:36.434 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.436 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:55:36.437 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 07:55:36.466 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:55:36.490 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:55:36.493 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 07:55:36.495 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:55:36.497 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 07:55:36.531 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:55:36.533 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 07:55:36.534 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 07:55:36.570 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:55:36.572 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 07:55:36.574 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:55:36.576 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 07:55:36.598 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.605 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:55:36.607 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 07:55:36.607 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 07:55:36.609 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 07:55:36.609 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: name 'response' is not defined
2025-06-22 07:55:36.788 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.797 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:55:36.799 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 07:55:36.799 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 07:55:36.800 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 401
2025-06-22 07:55:36.806 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.815 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:55:36.817 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 07:55:36.817 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 07:55:36.823 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.834 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:55:36.836 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 07:55:36.836 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 07:55:36.837 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 07:55:36.857 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.865 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:55:36.884 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.892 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:55:36.914 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.918 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:55:36.923 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.928 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:55:36.928 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:55:36.933 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.937 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:55:36.938 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:55:36.944 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.965 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 07:55:36.972 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.977 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:55:36.983 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:36.988 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:55:36.994 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.000 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:55:37.006 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.011 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:55:37.016 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.017 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:55:37.017 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:55:37.018 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:55:37.019 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:55:37.024 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.025 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 07:55:37.026 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 07:55:37.031 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.035 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:55:37.041 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.045 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:55:37.104 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.109 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:55:37.114 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.130 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.137 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.138 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:55:37.139 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:55:37.146 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.147 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:55:37.147 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:55:37.152 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.161 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 07:55:37.188 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.193 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 07:55:37.198 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.205 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.387 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:55:37.388 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.389 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:55:37.389 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:55:37.389 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:55:37.390 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:55:37.390 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 07:55:37.423 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:55:37.436 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:55:37.440 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.441 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:55:37.442 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:55:37.443 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:55:37.445 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 07:55:37.446 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 07:55:37.472 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:55:37.588 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:55:37.596 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 07:57:53.594 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 07:57:53.595 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 07:57:53.879 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:57:53.880 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:53.880 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:57:53.881 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:57:53.885 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 07:57:53.886 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:57:53.886 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:57:53.887 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 07:57:53.887 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/1.1
2025-06-22 07:57:53.888 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 07:57:53.888 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:317 - Retry 1/1 in 0.02s
2025-06-22 07:57:53.909 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:319 - Playwright scraping failed after all attempts
2025-06-22 07:57:53.909 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:57:53.910 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:57:53.910 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:57:55.556 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 07:57:55.560 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.68 seconds
2025-06-22 07:57:55.561 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 2489.35    ┆ 3939.28     ┆ -1449.93   ┆ 2251.7     ┆ 1979.92     ┆ 271.78     │
│ 2025-06-19 ┆ 2246.97    ┆ 3551.59     ┆ -1304.62   ┆ 3796.57    ┆ 3316.77     ┆ 479.8      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:57:55.587 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:57:55.775 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:57:55.776 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:55.776 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:57:55.777 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:57:55.779 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 07:57:55.779 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:57:55.780 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:57:55.796 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7fbaa928dee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7fbaa920fa70: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7fbaa928dd00>
           └ <coverage.cmdline.CoverageScript object at 0x7fbaa920ec60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7fbaa928d1c0>
    └ <coverage.execfile.PyRunner object at 0x7fbaa920f530>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7fbaa88b2670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7fbaa8ad6160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7fbaa9e21940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7fbaa8b14aa0>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fbaa88d7bc0>
         │                └ <_pytest.config.Config object at 0x7fbaa8b14aa0>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7fbaa8b14aa0>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7fbaa8b14aa0>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7fbaa90c2ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fbaa889e900>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7fbaa8b14aa0>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7fbaa8ba47c0>
           │            └ <_pytest.config.Config object at 0x7fbaa8b14aa0>
           └ <function wrap_session at 0x7fbaa8ba4400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7fbaa8b14aa0>
    │       │            └ <function _main at 0x7fbaa8ba47c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fbaa88d7bc0>
    └ <_pytest.config.Config object at 0x7fbaa8b14aa0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7fbaa90c2ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fbaa889e900>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7fbaa90c2ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fbaa889e900>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7fbaa8b937e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7fbaa8b93d80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7fbaa8ba40e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7fba977167a0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7fbaa90c2ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fbaa889e900>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7fbaa8328e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7fbaa8b021b0>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7fbaa90c2ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fbaa889e900>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7fba70b08470>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7fba97717e20>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7fbaa8375620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fbaa8375580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fbaa8377380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fbaa85af880>
    └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 167, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7fba98083ba0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7fba98083740>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fbaa0ffc290>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7fba98083920>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fbaa0ffc290>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7fba98083880>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fbaa0ffc290>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7fbaa1005e40>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7fbaa1b4f880>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7fba6b62a240>}
           │         └ (<LazyFrame at 0x7FBA6B62A060>,)
           └ <function LazyFrame.collect at 0x7fbaa11a8720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7fba6b62b1d0>}
           │         └ (<LazyFrame at 0x7FBA6B62A060>,)
           └ <function LazyFrame.collect at 0x7fbaa11a8680>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7fba6b857c50>
           └ <function wrap_df at 0x7fbaa1aef380>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 07:57:55.854 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:57:55.855 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:57:55.855 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:57:55.887 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 07:57:55.890 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.11 seconds
2025-06-22 07:57:55.891 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 3812.12    ┆ 5441.81     ┆ -1629.69   ┆ 1796.08    ┆ 3708.81     ┆ -1912.73   │
│ 2025-06-19 ┆ 5665.38    ┆ 6014.88     ┆ -349.5     ┆ 1739.41    ┆ 1502.68     ┆ 236.73     │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:57:55.917 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:57:55.971 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:57:55.972 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:55.973 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:57:55.973 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:57:55.973 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:57:55.974 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:57:55.974 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 07:57:56.001 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:57:56.026 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:57:56.027 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.035 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmpz8v3djsl.db" exists, but it is not a valid DuckDB database file!
2025-06-22 07:57:56.035 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 07:57:56.036 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:57:56.041 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpz8v3djsl.db" exists, but it is not a valid DuckDB database file!
2025-06-22 07:57:56.065 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:57:56.065 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.068 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:57:56.068 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 07:57:56.092 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:57:56.115 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:57:56.118 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 07:57:56.120 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:57:56.123 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 07:57:56.157 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:57:56.159 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 07:57:56.161 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 07:57:56.198 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:57:56.200 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 07:57:56.202 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:57:56.205 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 07:57:56.227 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.234 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:57:56.237 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 07:57:56.237 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 07:57:56.238 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 07:57:56.238 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: name 'response' is not defined
2025-06-22 07:57:56.425 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.433 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:57:56.435 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 07:57:56.435 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 07:57:56.436 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 401
2025-06-22 07:57:56.441 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.450 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:57:56.452 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 07:57:56.452 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 07:57:56.458 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.468 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:57:56.469 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 07:57:56.470 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 07:57:56.471 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 07:57:56.490 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.498 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:57:56.517 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.525 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:57:56.539 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.542 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:57:56.547 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.552 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:57:56.553 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:57:56.557 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.562 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:57:56.562 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:57:56.569 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.578 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 07:57:56.584 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.588 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:57:56.594 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.599 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:57:56.605 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.610 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:57:56.616 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.621 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:57:56.626 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.627 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:57:56.628 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:57:56.629 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:57:56.629 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:57:56.635 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.636 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 07:57:56.637 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 07:57:56.642 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.646 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:57:56.653 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.657 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:57:56.718 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.723 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:57:56.728 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.744 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.751 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.752 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:57:56.753 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:57:56.759 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.760 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:57:56.761 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:57:56.765 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.774 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 07:57:56.801 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.806 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 07:57:56.811 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:56.818 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:57.012 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:57:57.013 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:57.013 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:57:57.014 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:57:57.014 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:57:57.014 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:57:57.015 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 07:57:57.042 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:57:57.056 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:57:57.060 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:57.061 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:57:57.064 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:57:57.066 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:57:57.068 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 07:57:57.070 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 07:57:57.096 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:57:57.212 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:57:57.219 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 07:59:41.736 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 07:59:41.737 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 07:59:41.992 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:59:41.993 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:41.993 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:59:41.994 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:59:41.998 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 07:59:41.998 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:59:41.999 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:59:41.999 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 07:59:42.000 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/1.1
2025-06-22 07:59:42.000 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 07:59:42.001 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:317 - Retry 1/1 in 0.02s
2025-06-22 07:59:42.021 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:319 - Playwright scraping failed after all attempts
2025-06-22 07:59:42.021 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:59:42.022 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:59:42.023 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:59:43.435 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 07:59:43.438 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.45 seconds
2025-06-22 07:59:43.439 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 5056.35    ┆ 2679.26     ┆ 2377.09    ┆ 2199.5     ┆ 1508.04     ┆ 691.46     │
│ 2025-06-19 ┆ 6774.82    ┆ 5357.71     ┆ 1417.11    ┆ 2492.85    ┆ 2907.27     ┆ -414.42    │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:59:43.470 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:59:43.654 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:59:43.655 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:43.655 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:59:43.656 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:59:43.658 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 07:59:43.659 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:59:43.659 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:59:43.675 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7fb00482dee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7fb0047afa70: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7fb00482dd00>
           └ <coverage.cmdline.CoverageScript object at 0x7fb0047aec60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7fb00482d1c0>
    └ <coverage.execfile.PyRunner object at 0x7fb0047af530>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7fb003e52670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7fb004076160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7fb0053c1940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7fb0040b4aa0>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fb003fb3200>
         │                └ <_pytest.config.Config object at 0x7fb0040b4aa0>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7fb0040b4aa0>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7fb0040b4aa0>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7fb004662ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fb0045259a0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7fb0040b4aa0>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7fb0041447c0>
           │            └ <_pytest.config.Config object at 0x7fb0040b4aa0>
           └ <function wrap_session at 0x7fb004144400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7fb0040b4aa0>
    │       │            └ <function _main at 0x7fb0041447c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fb003fb3200>
    └ <_pytest.config.Config object at 0x7fb0040b4aa0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7fb004662ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fb0045259a0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7fb004662ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fb0045259a0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7fb0041337e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7fb004133d80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7fb0041440e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7faff231e7a0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7fb004662ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fb0045259a0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7fb0038c8e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7fb0040a21b0>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7fb004662ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fb0045259a0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7faff193f740>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7faff231fe20>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7fb003915620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fb003915580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fb003917380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fb003b4f880>
    └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 172, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7faff2d2fba0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7faff2d2f740>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fafceb71580>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7faff2d2f920>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fafceb71580>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7faff2d2f880>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fafceb71580>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7faffc505e40>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7faffd937880>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7fafcebc70e0>}
           │         └ (<LazyFrame at 0x7FAFCEBC76E0>,)
           └ <function LazyFrame.collect at 0x7faffcfac720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7fafceb733b0>}
           │         └ (<LazyFrame at 0x7FAFCEBC76E0>,)
           └ <function LazyFrame.collect at 0x7faffcfac680>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7fafcedf3c50>
           └ <function wrap_df at 0x7faffd8d7380>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 07:59:43.712 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:59:43.713 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:59:43.713 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:59:43.734 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 07:59:43.737 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.08 seconds
2025-06-22 07:59:43.738 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 3347.62    ┆ 3000.64     ┆ 346.98     ┆ 3295.25    ┆ 2629.41     ┆ 665.84     │
│ 2025-06-19 ┆ 4789.57    ┆ 5625.47     ┆ -835.9     ┆ 2302.42    ┆ 2304.63     ┆ -2.21      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:59:43.762 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:59:43.816 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:59:43.817 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:43.817 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:59:43.818 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:59:43.818 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:59:43.819 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:59:43.819 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 07:59:43.847 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:59:43.874 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:59:43.874 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:43.883 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmpufu_zzss.db" exists, but it is not a valid DuckDB database file!
2025-06-22 07:59:43.883 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 07:59:43.884 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:59:43.889 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpufu_zzss.db" exists, but it is not a valid DuckDB database file!
2025-06-22 07:59:43.913 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:59:43.914 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:43.916 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:59:43.917 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 07:59:43.941 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:59:43.965 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:59:43.966 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 07:59:43.967 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:59:43.967 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 07:59:44.001 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:59:44.001 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 07:59:44.002 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 07:59:44.038 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:59:44.039 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 07:59:44.039 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 07:59:44.040 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 07:59:44.060 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.068 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:59:44.070 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 07:59:44.070 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 07:59:44.071 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 07:59:44.071 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: name 'response' is not defined
2025-06-22 07:59:44.194 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.202 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:59:44.204 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 07:59:44.204 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 07:59:44.206 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 401
2025-06-22 07:59:44.211 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.219 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:59:44.221 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 07:59:44.222 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 07:59:44.227 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.238 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:59:44.239 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 07:59:44.240 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 07:59:44.241 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 07:59:44.260 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.268 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 07:59:44.288 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.295 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 07:59:44.308 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.312 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:59:44.317 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.322 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:59:44.322 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:59:44.327 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.331 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:59:44.331 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:59:44.338 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.346 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 07:59:44.352 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.357 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:59:44.363 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.368 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:59:44.374 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.380 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:59:44.386 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.390 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:59:44.396 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.397 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:59:44.397 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:59:44.398 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:59:44.399 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 07:59:44.404 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.405 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 07:59:44.406 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 07:59:44.411 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.415 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:59:44.422 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.426 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:59:44.484 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.489 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 07:59:44.494 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.510 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.517 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.519 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:59:44.519 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:59:44.526 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.527 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 07:59:44.528 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 07:59:44.532 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.541 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 07:59:44.569 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.575 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 07:59:44.580 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.587 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.794 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:59:44.795 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.795 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:59:44.796 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:59:44.796 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:59:44.797 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:59:44.797 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 07:59:44.825 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:59:44.838 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 07:59:44.841 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.841 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 07:59:44.841 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 07:59:44.842 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 07:59:44.842 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 07:59:44.843 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 07:59:44.869 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 07:59:44.991 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 07:59:44.999 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:00:25.209 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:00:25.210 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:00:25.458 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:00:25.459 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:25.459 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:00:25.460 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:00:25.464 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 08:00:25.464 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:00:25.465 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:00:25.466 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 08:00:25.466 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/1.1
2025-06-22 08:00:25.466 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 08:00:25.467 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:317 - Retry 1/1 in 0.02s
2025-06-22 08:00:25.487 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:319 - Playwright scraping failed after all attempts
2025-06-22 08:00:25.488 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:00:25.489 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:00:25.489 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:00:26.742 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 08:00:26.745 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.29 seconds
2025-06-22 08:00:26.746 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 5733.59    ┆ 5645.02     ┆ 88.57      ┆ 1826.74    ┆ 2051.94     ┆ -225.2     │
│ 2025-06-19 ┆ 6934.98    ┆ 5881.23     ┆ 1053.75    ┆ 1837.43    ┆ 3019.02     ┆ -1181.59   │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:00:26.772 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:00:26.954 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:00:26.955 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:26.955 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:00:26.956 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:00:26.958 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 08:00:26.959 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:00:26.959 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:00:26.973 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7fc8bbd91ee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7fc8bbd13950: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7fc8bbd91d00>
           └ <coverage.cmdline.CoverageScript object at 0x7fc8bbd12ba0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7fc8bbd911c0>
    └ <coverage.execfile.PyRunner object at 0x7fc8bbd13110>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7fc8bb39e670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7fc8bb8ee160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7fc8bc92d940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7fc8bc1dee70>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fc8bb3c3e30>
         │                └ <_pytest.config.Config object at 0x7fc8bc1dee70>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7fc8bc1dee70>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7fc8bc1dee70>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7fc8bbbcaca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fc8bbdb6a80>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7fc8bc1dee70>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7fc8bb69c7c0>
           │            └ <_pytest.config.Config object at 0x7fc8bc1dee70>
           └ <function wrap_session at 0x7fc8bb69c400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7fc8bc1dee70>
    │       │            └ <function _main at 0x7fc8bb69c7c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fc8bb3c3e30>
    └ <_pytest.config.Config object at 0x7fc8bc1dee70>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7fc8bbbcaca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fc8bbdb6a80>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7fc8bbbcaca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fc8bbdb6a80>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7fc8bb68b7e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7fc8bb68bd80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7fc8bb69c0e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7fc8aa3fa7a0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7fc8bbbcaca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fc8bbdb6a80>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7fc8bae18e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7fc8bb5fa1b0>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7fc8bbbcaca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fc8bbdb6a80>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7fc8aa37b020>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7fc8aa3fbe20>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7fc8bb10d620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fc8bb10d580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fc8bb10f380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fc8bb09f880>
    └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 172, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7fc8aa30bba0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7fc8aa30b740>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fc886d1f500>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7fc8aa30b920>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fc886d1f500>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7fc8aa30b880>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fc886d1f500>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7fc8b45e1e40>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7fc8b4ef3880>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7fc886297890>}
           │         └ (<LazyFrame at 0x7FC8A0040050>,)
           └ <function LazyFrame.collect at 0x7fc8b4588720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7fc8867aff80>}
           │         └ (<LazyFrame at 0x7FC8A0040050>,)
           └ <function LazyFrame.collect at 0x7fc8b4588680>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7fc886387c50>
           └ <function wrap_df at 0x7fc8b4e93380>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 08:00:27.010 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:00:27.010 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:00:27.011 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:00:27.031 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 08:00:27.034 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.08 seconds
2025-06-22 08:00:27.034 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 2936.02    ┆ 6348.6      ┆ -3412.58   ┆ 1940.88    ┆ 1999.09     ┆ -58.21     │
│ 2025-06-19 ┆ 7992.03    ┆ 2195.9      ┆ 5796.13    ┆ 2902.35    ┆ 2955.03     ┆ -52.68     │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:00:27.058 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:00:27.112 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:00:27.112 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.113 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:00:27.113 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:00:27.114 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:00:27.114 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:00:27.114 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:00:27.140 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:00:27.166 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:00:27.166 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.174 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmpnmuy5q8w.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:00:27.174 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:00:27.175 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:00:27.182 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpnmuy5q8w.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:00:27.206 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:00:27.207 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.209 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:00:27.209 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:00:27.233 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:00:27.257 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:00:27.257 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:00:27.258 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:00:27.259 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:00:27.292 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:00:27.293 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 08:00:27.293 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:00:27.329 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:00:27.330 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:00:27.330 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:00:27.331 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:00:27.352 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.359 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:00:27.361 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:00:27.361 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:00:27.363 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:00:27.364 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:00:27.364 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:00:27.371 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.379 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:00:27.380 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:00:27.381 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:00:27.382 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 401
2025-06-22 08:00:27.387 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.395 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:00:27.397 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:00:27.397 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:00:27.403 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.411 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:00:27.413 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:00:27.413 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:00:27.414 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:00:27.422 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.430 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:00:27.450 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.457 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:00:27.468 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.472 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:00:27.476 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.480 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:00:27.480 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:00:27.485 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.490 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:00:27.491 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:00:27.498 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.505 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:00:27.511 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.516 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:00:27.522 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.527 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:00:27.533 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.538 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:00:27.544 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.549 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:00:27.554 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.556 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:00:27.556 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:00:27.557 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:00:27.558 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:00:27.563 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.564 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 08:00:27.565 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 08:00:27.570 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.574 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:00:27.579 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.582 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:00:27.642 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.647 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:00:27.652 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.668 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.675 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.676 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:00:27.677 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:00:27.683 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.685 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:00:27.685 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:00:27.690 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.698 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:00:27.724 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.731 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 08:00:27.736 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.744 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.883 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:00:27.884 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.885 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:00:27.885 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:00:27.886 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:00:27.886 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:00:27.886 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:00:27.914 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:00:27.927 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:00:27.928 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:27.928 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:00:27.928 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:00:27.929 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:00:27.929 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:00:27.930 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:00:27.954 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:00:28.069 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:00:28.076 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:01:39.039 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:01:39.040 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:01:39.279 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:01:39.279 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:39.280 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:01:39.280 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:01:39.284 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 08:01:39.285 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:01:39.285 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:01:39.286 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 08:01:39.286 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/1.1
2025-06-22 08:01:39.286 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 08:01:39.287 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:317 - Retry 1/1 in 0.02s
2025-06-22 08:01:39.307 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:319 - Playwright scraping failed after all attempts
2025-06-22 08:01:39.308 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:01:39.308 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:01:39.309 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:01:40.555 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 08:01:40.558 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.28 seconds
2025-06-22 08:01:40.559 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 6773.63    ┆ 3206.25     ┆ 3567.38    ┆ 1675.47    ┆ 3351.24     ┆ -1675.77   │
│ 2025-06-19 ┆ 3173.74    ┆ 3750.44     ┆ -576.7     ┆ 3379.38    ┆ 2867.72     ┆ 511.66     │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:01:40.584 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:01:40.773 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:01:40.773 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:40.774 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:01:40.774 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:01:40.777 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 08:01:40.777 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:01:40.777 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:01:40.792 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7f9b529cdee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7f9b5294fce0: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7f9b529cdd00>
           └ <coverage.cmdline.CoverageScript object at 0x7f9b5294eed0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7f9b529cd1c0>
    └ <coverage.execfile.PyRunner object at 0x7f9b52dd3410>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7f9b51ff2670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7f9b52216160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7f9b53561940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7f9b5217fb30>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f9b52017f80>
         │                └ <_pytest.config.Config object at 0x7f9b5217fb30>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7f9b5217fb30>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7f9b5217fb30>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7f9b52806ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f9b51fdde50>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7f9b5217fb30>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7f9b522e47c0>
           │            └ <_pytest.config.Config object at 0x7f9b5217fb30>
           └ <function wrap_session at 0x7f9b522e4400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7f9b5217fb30>
    │       │            └ <function _main at 0x7f9b522e47c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f9b52017f80>
    └ <_pytest.config.Config object at 0x7f9b5217fb30>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7f9b52806ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f9b51fdde50>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7f9b52806ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f9b51fdde50>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7f9b522d37e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7f9b522d3d80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7f9b522e40e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7f9b484167a0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7f9b52806ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f9b51fdde50>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7f9b51a64e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7f9b52242110>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7f9b52806ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f9b51fdde50>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7f9b485b8650>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7f9b48417e20>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7f9b51d55620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f9b51d55580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f9b51d57380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f9b51ceb880>
    └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 172, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7f9b48527ba0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7f9b48527740>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f9b3e34cda0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7f9b48527920>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f9b3e34cda0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7f9b48527880>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f9b3e34cda0>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7f9b4b1fde40>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7f9b4bacf880>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f9b3e34dfa0>}
           │         └ (<LazyFrame at 0x7F9B1CD70260>,)
           └ <function LazyFrame.collect at 0x7f9b4b1a4720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f9b1cd434a0>}
           │         └ (<LazyFrame at 0x7F9B1CD70260>,)
           └ <function LazyFrame.collect at 0x7f9b4b1a4680>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7f9b1ceefc50>
           └ <function wrap_df at 0x7f9b4ba6f380>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 08:01:40.828 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:01:40.829 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:01:40.829 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:01:40.849 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 08:01:40.852 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.08 seconds
2025-06-22 08:01:40.852 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 3075.37    ┆ 4666.29     ┆ -1590.92   ┆ 2580.2     ┆ 1949.99     ┆ 630.21     │
│ 2025-06-19 ┆ 2442.11    ┆ 4662.28     ┆ -2220.17   ┆ 3482.46    ┆ 2414.03     ┆ 1068.43    │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:01:40.877 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:01:40.935 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:01:40.936 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:40.936 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:01:40.937 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:01:40.937 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:01:40.938 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:01:40.938 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:01:40.966 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:01:40.992 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:01:40.992 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.000 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmpri37i_pd.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:01:41.000 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:01:41.001 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:01:41.006 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpri37i_pd.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:01:41.029 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:01:41.029 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.032 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:01:41.032 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:01:41.056 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:01:41.079 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:01:41.084 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:01:41.089 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:01:41.094 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:01:41.131 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:01:41.136 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 08:01:41.140 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:01:41.178 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:01:41.183 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:01:41.188 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:01:41.194 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:01:41.217 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.224 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:01:41.226 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:01:41.226 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:01:41.227 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:01:41.228 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:01:41.229 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:01:41.235 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.243 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:01:41.244 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:01:41.245 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:01:41.246 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 401
2025-06-22 08:01:41.251 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.259 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:01:41.261 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:01:41.261 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:01:41.267 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.275 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:01:41.276 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:01:41.277 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:01:41.278 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:01:41.285 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.293 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:01:41.312 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.320 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:01:41.330 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.334 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:01:41.338 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.342 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:01:41.342 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:01:41.347 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.353 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:01:41.353 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:01:41.360 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.367 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:01:41.373 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.377 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:01:41.383 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.388 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:01:41.394 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.399 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:01:41.405 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.410 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:01:41.415 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.416 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:01:41.417 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:01:41.418 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:01:41.418 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:01:41.424 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.425 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 08:01:41.426 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 08:01:41.431 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.435 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:01:41.440 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.443 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:01:41.500 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.505 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:01:41.510 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.529 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.536 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.537 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:01:41.537 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:01:41.544 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.545 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:01:41.545 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:01:41.550 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.559 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:01:41.584 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.591 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 08:01:41.595 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.602 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.831 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:01:41.832 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.832 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:01:41.833 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:01:41.833 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:01:41.833 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:01:41.834 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:01:41.861 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:01:41.874 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:01:41.879 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:41.884 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:01:41.889 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:01:41.894 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:01:41.899 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.02 seconds
2025-06-22 08:01:41.903 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:01:41.932 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:01:42.052 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:01:42.060 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:02:47.804 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:02:47.805 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:02:48.086 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:02:48.087 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:48.088 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:02:48.088 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:02:48.092 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 08:02:48.093 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:02:48.093 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:02:48.094 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 08:02:48.094 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/1.1
2025-06-22 08:02:48.095 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 08:02:48.095 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:317 - Retry 1/1 in 0.02s
2025-06-22 08:02:48.116 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:319 - Playwright scraping failed after all attempts
2025-06-22 08:02:48.116 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:02:48.117 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:02:48.117 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:02:49.807 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 08:02:49.812 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.73 seconds
2025-06-22 08:02:49.813 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 3547.04    ┆ 5543.34     ┆ -1996.3    ┆ 2699.43    ┆ 2806.64     ┆ -107.21    │
│ 2025-06-19 ┆ 3343.97    ┆ 2942.53     ┆ 401.44     ┆ 3797.83    ┆ 2879.32     ┆ 918.51     │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:02:49.839 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:02:50.022 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:02:50.022 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.023 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:02:50.023 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:02:50.026 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 08:02:50.026 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:02:50.026 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:02:50.041 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7faf26d61ee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7faf26cdfe00: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7faf26d61d00>
           └ <coverage.cmdline.CoverageScript object at 0x7faf26cdef30>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7faf26d611c0>
    └ <coverage.execfile.PyRunner object at 0x7faf26cdf4d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7faf26382670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7faf265aa160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7faf278f1940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7faf26acbc50>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7faf26591e20>
         │                └ <_pytest.config.Config object at 0x7faf26acbc50>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7faf26acbc50>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7faf26acbc50>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7faf26b96ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7faf26d75a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7faf26acbc50>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7faf266747c0>
           │            └ <_pytest.config.Config object at 0x7faf26acbc50>
           └ <function wrap_session at 0x7faf26674400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7faf26acbc50>
    │       │            └ <function _main at 0x7faf266747c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7faf26591e20>
    └ <_pytest.config.Config object at 0x7faf26acbc50>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7faf26b96ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7faf26d75a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7faf26b96ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7faf26d75a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7faf266637e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7faf26663d80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7faf266740e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7faf1c8167a0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7faf26b96ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7faf26d75a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7faf25df4e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7faf265d2110>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7faf26b96ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7faf26d75a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7faf1c9b4770>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7faf1c817e20>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7faf260ed620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7faf260ed580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7faf260ef380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7faf2607f880>
    └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 172, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7faf1c927ba0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7faf1c927740>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7faef10f6180>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7faf1c927920>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7faef10f6180>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7faf1c927880>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7faef10f6180>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7faf1ff0de40>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7faf1f5bb880>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7faef17503b0>}
           │         └ (<LazyFrame at 0x7FAEF112FA40>,)
           └ <function LazyFrame.collect at 0x7faf1feb4720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7faef112e1b0>}
           │         └ (<LazyFrame at 0x7FAEF112FA40>,)
           └ <function LazyFrame.collect at 0x7faf1feb4680>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7faef135bc50>
           └ <function wrap_df at 0x7faf1f55b380>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 08:02:50.111 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:02:50.112 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:02:50.112 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:02:50.148 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 08:02:50.151 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.13 seconds
2025-06-22 08:02:50.152 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 7878.34    ┆ 2366.05     ┆ 5512.29    ┆ 2363.53    ┆ 3021.92     ┆ -658.39    │
│ 2025-06-19 ┆ 6757.18    ┆ 6135.37     ┆ 621.81     ┆ 2265.74    ┆ 3358.16     ┆ -1092.42   │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:02:50.176 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:02:50.228 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:02:50.229 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.229 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:02:50.230 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:02:50.230 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:02:50.230 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:02:50.231 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:02:50.256 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:02:50.284 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:02:50.284 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.292 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmpomq9ca_u.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:02:50.293 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:02:50.293 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:02:50.298 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpomq9ca_u.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:02:50.322 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:02:50.322 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.325 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:02:50.325 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:02:50.349 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:02:50.372 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:02:50.373 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:02:50.374 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:02:50.375 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:02:50.408 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:02:50.409 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 08:02:50.409 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:02:50.445 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:02:50.446 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:02:50.446 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:02:50.447 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:02:50.470 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.478 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:02:50.480 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:02:50.480 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:02:50.482 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:02:50.482 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:02:50.483 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:02:50.491 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.499 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:02:50.501 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:02:50.501 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:02:50.502 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 401
2025-06-22 08:02:50.507 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.516 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:02:50.518 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:02:50.518 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:02:50.524 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.534 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:02:50.536 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:02:50.537 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:02:50.538 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:02:50.546 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.553 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:02:50.576 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.583 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:02:50.594 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.598 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:02:50.603 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.607 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:02:50.608 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:02:50.613 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.618 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:02:50.619 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:02:50.626 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.634 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:02:50.641 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.648 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:02:50.654 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.659 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:02:50.665 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.670 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:02:50.677 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.682 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:02:50.687 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.688 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:02:50.689 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:02:50.689 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:02:50.690 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:02:50.696 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.697 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 08:02:50.697 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 08:02:50.703 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.706 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:02:50.711 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.715 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:02:50.774 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.779 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:02:50.784 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.804 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.811 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.812 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:02:50.812 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:02:50.819 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.820 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:02:50.820 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:02:50.825 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.834 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:02:50.863 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.870 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 08:02:50.874 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:50.881 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:51.095 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:02:51.096 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:51.096 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:02:51.097 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:02:51.097 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:02:51.097 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:02:51.098 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:02:51.125 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:02:51.138 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:02:51.139 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:51.139 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:02:51.140 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:02:51.140 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:02:51.141 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:02:51.141 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:02:51.165 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:02:51.280 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:02:51.287 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:04:50.835 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:04:50.836 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:04:51.074 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:04:51.075 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:51.076 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:04:51.076 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:04:51.080 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 08:04:51.080 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:04:51.081 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:04:51.082 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 08:04:51.082 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/1.1
2025-06-22 08:04:51.082 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:314 - Unexpected error: Playwright should not be called in API success path
2025-06-22 08:04:51.083 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:317 - Retry 1/1 in 0.02s
2025-06-22 08:04:51.103 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:319 - Playwright scraping failed after all attempts
2025-06-22 08:04:51.104 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:04:51.104 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:04:51.105 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:04:52.460 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 08:04:52.463 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.39 seconds
2025-06-22 08:04:52.464 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 2181.88    ┆ 4686.5      ┆ -2504.62   ┆ 2594.95    ┆ 1407.41     ┆ 1187.54    │
│ 2025-06-19 ┆ 2264.95    ┆ 5515.54     ┆ -3250.59   ┆ 1796.46    ┆ 3596.0      ┆ -1799.54   │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:04:52.489 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:04:52.670 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:04:52.670 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:52.671 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:04:52.671 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:04:52.674 | WARNING  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:143 - Home page fetch for session setup failed: Mock object has no attribute 'cookies'
2025-06-22 08:04:52.675 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:04:52.675 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:04:52.690 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7f86ec281ee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7f86ec203a70: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7f86ec281d00>
           └ <coverage.cmdline.CoverageScript object at 0x7f86ec202c60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7f86ec2811c0>
    └ <coverage.execfile.PyRunner object at 0x7f86ec203530>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7f86eb8a6670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7f86ebaca160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7f86ece15940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7f86ebb08aa0>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f86ec782f30>
         │                └ <_pytest.config.Config object at 0x7f86ebb08aa0>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7f86ebb08aa0>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7f86ebb08aa0>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7f86ec0b6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f86ebf799a0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7f86ebb08aa0>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7f86ebb987c0>
           │            └ <_pytest.config.Config object at 0x7f86ebb08aa0>
           └ <function wrap_session at 0x7f86ebb98400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7f86ebb08aa0>
    │       │            └ <function _main at 0x7f86ebb987c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f86ec782f30>
    └ <_pytest.config.Config object at 0x7f86ebb08aa0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7f86ec0b6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f86ebf799a0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7f86ec0b6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f86ebf799a0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7f86ebb877e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7f86ebb87d80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7f86ebb980e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7f86da71e7a0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7f86ec0b6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f86ebf799a0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7f86eb31ce00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7f86ebaf61b0>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7f86ec0b6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f86ebf799a0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7f86db0cb8c0>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7f86da71fe20>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7f86eb369620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f86eb369580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f86eb36b380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f86eb5a7880>
    └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...e 'cookies'")>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 173, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7f86db03fba0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7f86db03f740>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f86b6611f40>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7f86db03f920>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f86b6611f40>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7f86db03f880>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f86b6611f40>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7f86e4005e40>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7f86e4b4f880>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f86b665e7b0>}
           │         └ (<LazyFrame at 0x7F86B665E8D0>,)
           └ <function LazyFrame.collect at 0x7f86e41ac720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f86b665e870>}
           │         └ (<LazyFrame at 0x7F86B665E8D0>,)
           └ <function LazyFrame.collect at 0x7f86e41ac680>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7f86b688bc50>
           └ <function wrap_df at 0x7f86e4aef380>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 08:04:52.754 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:04:52.754 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:04:52.755 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:04:52.785 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 08:04:52.788 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.12 seconds
2025-06-22 08:04:52.789 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 3632.04    ┆ 2153.06     ┆ 1478.98    ┆ 2251.07    ┆ 1466.05     ┆ 785.02     │
│ 2025-06-19 ┆ 3784.79    ┆ 2161.77     ┆ 1623.02    ┆ 3976.32    ┆ 2738.28     ┆ 1238.04    │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:04:52.812 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:04:52.865 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:04:52.866 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:52.866 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:04:52.867 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:04:52.867 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:04:52.868 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:04:52.868 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:04:52.895 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:04:52.922 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:04:52.922 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:52.930 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmpbbpi1bo6.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:04:52.931 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:04:52.931 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:04:52.936 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpbbpi1bo6.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:04:52.960 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:04:52.961 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:52.963 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:04:52.963 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:04:52.988 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:04:53.012 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:04:53.014 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:04:53.016 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:04:53.017 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:04:53.052 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:04:53.053 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 08:04:53.055 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:04:53.090 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:04:53.092 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:04:53.094 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:04:53.096 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:04:53.117 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.125 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:04:53.127 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:04:53.127 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:04:53.128 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:04:53.129 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:04:53.129 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:04:53.136 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.144 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:04:53.146 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:04:53.146 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:04:53.147 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 401
2025-06-22 08:04:53.152 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.161 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:04:53.163 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:04:53.164 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:04:53.169 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.179 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:04:53.180 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:04:53.181 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:04:53.182 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:04:53.190 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.198 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:04:53.221 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.229 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:04:53.240 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.243 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:04:53.248 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.252 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:04:53.252 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:04:53.257 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.263 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:04:53.263 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:04:53.270 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.277 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:04:53.283 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.288 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:04:53.294 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.299 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:04:53.304 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.310 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:04:53.316 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.321 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:04:53.327 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.328 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:04:53.329 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:04:53.330 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:04:53.330 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:04:53.336 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.337 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 08:04:53.338 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 08:04:53.344 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.349 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:04:53.354 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.357 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:04:53.417 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.421 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:04:53.426 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.445 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.452 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.453 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:04:53.453 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:04:53.460 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.462 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:04:53.462 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:04:53.467 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.476 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:04:53.502 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.509 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 08:04:53.514 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.521 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.664 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:04:53.665 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.665 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:04:53.666 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:04:53.666 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:04:53.667 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:04:53.667 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:04:53.695 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:04:53.708 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:04:53.710 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.712 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:04:53.713 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:04:53.714 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:04:53.716 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:04:53.717 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:04:53.743 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:04:53.860 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:04:53.867 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:06:40.162 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:06:40.163 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:06:40.536 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:06:40.537 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:40.538 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:06:40.538 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:06:40.544 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {}
2025-06-22 08:06:40.544 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:06:40.547 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:06:40.548 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:06:40.548 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 08:06:40.558 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:06:41.990 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 2 records
2025-06-22 08:06:41.999 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.46 seconds
2025-06-22 08:06:42.001 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:06:42.031 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:06:42.235 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:06:42.236 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.236 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:06:42.237 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:06:42.241 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {}
2025-06-22 08:06:42.241 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:06:42.245 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 500
2025-06-22 08:06:42.245 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: API Server Error
2025-06-22 08:06:42.245 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:06:42.246 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:06:42.262 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7fb54a0a1ee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7fb54a01fe00: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7fb54a0a1d00>
           └ <coverage.cmdline.CoverageScript object at 0x7fb54a01ef30>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7fb54a0a11c0>
    └ <coverage.execfile.PyRunner object at 0x7fb54a01f4d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7fb5496c2670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7fb5498ea160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7fb54ac31940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7fb549e0bc50>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fb5496e7770>
         │                └ <_pytest.config.Config object at 0x7fb549e0bc50>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7fb549e0bc50>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7fb549e0bc50>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7fb549ed6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fb54a0b6ea0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7fb549e0bc50>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7fb5499b47c0>
           │            └ <_pytest.config.Config object at 0x7fb549e0bc50>
           └ <function wrap_session at 0x7fb5499b4400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7fb549e0bc50>
    │       │            └ <function _main at 0x7fb5499b47c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fb5496e7770>
    └ <_pytest.config.Config object at 0x7fb549e0bc50>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7fb549ed6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fb54a0b6ea0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7fb549ed6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fb54a0b6ea0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7fb5499a37e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7fb5499a3d80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7fb5499b40e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7fb5401127a0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7fb549ed6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fb54a0b6ea0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7fb549134e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7fb549912110>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7fb549ed6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fb54a0b6ea0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7fb5404bfbc0>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7fb540113e20>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7fb54942d620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fb54942d580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fb54942f380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fb5493bf880>
    └ <Handle Task.task_wakeup(<Future finis...15599383216'>>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...15599383216'>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...15599383216'>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...15599383216'>>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 175, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7fb540433ba0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7fb540433740>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fb5405f6de0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7fb540433920>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fb5405f6de0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7fb540433880>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fb5405f6de0>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7fb541ff9e40>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7fb542943880>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7fb50d1e8fb0>}
           │         └ (<LazyFrame at 0x7FB50D1E8EC0>,)
           └ <function LazyFrame.collect at 0x7fb541f9c720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7fb50d1e8ef0>}
           │         └ (<LazyFrame at 0x7FB50D1E8EC0>,)
           └ <function LazyFrame.collect at 0x7fb541f9c680>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7fb50d1fc030>
           └ <function wrap_df at 0x7fb5428e3380>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 08:06:42.305 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:06:42.307 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:06:42.307 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:06:42.329 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 08:06:42.332 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.10 seconds
2025-06-22 08:06:42.333 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 6440.88    ┆ 5105.8      ┆ 1335.08    ┆ 3927.88    ┆ 1926.75     ┆ 2001.13    │
│ 2025-06-19 ┆ 4882.28    ┆ 6361.02     ┆ -1478.74   ┆ 3405.8     ┆ 2705.49     ┆ 700.31     │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:06:42.358 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:06:42.422 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:06:42.423 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.423 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:06:42.423 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:06:42.424 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:06:42.424 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:06:42.425 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:06:42.465 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:06:42.493 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:06:42.494 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.502 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmpmayrb1va.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:06:42.502 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:06:42.503 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:06:42.508 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpmayrb1va.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:06:42.537 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:06:42.537 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.540 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:06:42.540 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:06:42.581 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:06:42.617 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:06:42.618 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:06:42.619 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:06:42.620 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:06:42.657 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:06:42.658 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 08:06:42.658 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:06:42.696 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:06:42.696 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:06:42.697 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:06:42.700 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:06:42.722 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.729 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:06:42.731 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:06:42.732 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:06:42.733 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:06:42.734 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:06:42.735 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:06:42.741 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.751 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:06:42.753 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:06:42.754 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:06:42.755 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 401
2025-06-22 08:06:42.760 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.770 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:06:42.772 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:06:42.772 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:06:42.780 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.791 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:06:42.793 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:06:42.793 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:06:42.794 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:06:42.799 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.807 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:06:42.829 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.837 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:06:42.850 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.854 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:06:42.858 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.864 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:06:42.864 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:06:42.869 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.873 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:06:42.873 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:06:42.883 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.889 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:06:42.895 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.899 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:06:42.905 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.909 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:06:42.916 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.921 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:06:42.928 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.933 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:06:42.938 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.940 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:06:42.940 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:06:42.941 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:06:42.942 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:06:42.947 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.949 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 08:06:42.949 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 08:06:42.955 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.959 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:06:42.966 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:42.970 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:06:43.029 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:43.034 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:06:43.039 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:43.055 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:43.062 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:43.063 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:06:43.064 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:06:43.070 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:43.071 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:06:43.072 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:06:43.076 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:43.085 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:06:43.113 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:43.119 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 08:06:43.124 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:43.131 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:43.273 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:06:43.274 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:43.274 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:06:43.275 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:06:43.275 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:06:43.276 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:06:43.276 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:06:43.303 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:06:43.316 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:06:43.318 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:43.319 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:06:43.319 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:06:43.320 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:06:43.320 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:06:43.321 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:06:43.345 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:06:43.465 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:06:43.472 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:21:19.462 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:21:19.464 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:21:19.738 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:21:19.739 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:19.739 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:21:19.740 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:21:19.746 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {}
2025-06-22 08:21:19.746 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:21:19.748 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:21:19.749 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:21:19.750 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 08:21:19.793 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:21:21.786 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 2 records
2025-06-22 08:21:21.792 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.05 seconds
2025-06-22 08:21:21.795 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:21:21.826 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:21:22.000 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:21:22.001 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.001 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:21:22.002 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:21:22.005 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {}
2025-06-22 08:21:22.005 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:21:22.007 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 500
2025-06-22 08:21:22.008 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: API Server Error
2025-06-22 08:21:22.008 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:21:22.008 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:21:22.020 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7f9d27405ee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7f9d27387a70: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7f9d27405d00>
           └ <coverage.cmdline.CoverageScript object at 0x7f9d27386c60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7f9d274051c0>
    └ <coverage.execfile.PyRunner object at 0x7f9d27387530>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7f9d26a2a670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7f9d26c4e160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7f9d27f99940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7f9d26c8caa0>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f9d26a4fbc0>
         │                └ <_pytest.config.Config object at 0x7f9d26c8caa0>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7f9d26c8caa0>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7f9d26c8caa0>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7f9d2723aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f9d26a16900>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7f9d26c8caa0>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7f9d26d1c7c0>
           │            └ <_pytest.config.Config object at 0x7f9d26c8caa0>
           └ <function wrap_session at 0x7f9d26d1c400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7f9d26c8caa0>
    │       │            └ <function _main at 0x7f9d26d1c7c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f9d26a4fbc0>
    └ <_pytest.config.Config object at 0x7f9d26c8caa0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7f9d2723aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f9d26a16900>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7f9d2723aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f9d26a16900>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7f9d26d0b7e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7f9d26d0bd80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7f9d26d1c0e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7f9d1c51e8e0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7f9d2723aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f9d26a16900>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7f9d264a0e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7f9d26c7a1b0>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7f9d2723aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f9d26a16900>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7f9d1cfbd970>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7f9d1c51ff60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7f9d264ed620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f9d264ed580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f9d264ef380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f9d26727880>
    └ <Handle Task.task_wakeup(<Future finis...12772924080'>>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...12772924080'>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...12772924080'>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...12772924080'>>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 175, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7f9d1cf33ba0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7f9d1cf33740>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f9ce5513b30>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7f9d1cf33920>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f9ce5513b30>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7f9d1cf33880>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f9ce5513b30>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7f9d1f105e40>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7f9d2050f880>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f9cf0535eb0>}
           │         └ (<LazyFrame at 0x7F9CE548DA00>,)
           └ <function LazyFrame.collect at 0x7f9d1fbac720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f9d1cfcdac0>}
           │         └ (<LazyFrame at 0x7F9CE548DA00>,)
           └ <function LazyFrame.collect at 0x7f9d1fbac680>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7f9cf006fab0>
           └ <function wrap_df at 0x7f9d204af380>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 08:21:22.093 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:21:22.094 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:21:22.095 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:21:22.126 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 08:21:22.129 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.13 seconds
2025-06-22 08:21:22.129 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 4333.76    ┆ 2912.99     ┆ 1420.77    ┆ 3985.94    ┆ 2406.74     ┆ 1579.2     │
│ 2025-06-19 ┆ 4267.44    ┆ 4673.0      ┆ -405.56    ┆ 3798.72    ┆ 2232.39     ┆ 1566.33    │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:21:22.151 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:21:22.200 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:21:22.200 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.201 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:21:22.201 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:21:22.201 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:21:22.202 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:21:22.202 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:21:22.225 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:21:22.248 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:21:22.248 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.256 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmpkhw57iy5.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:21:22.256 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:21:22.257 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:21:22.261 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpkhw57iy5.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:21:22.283 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:21:22.283 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.285 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:21:22.286 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:21:22.309 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:21:22.331 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:21:22.331 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:21:22.332 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:21:22.333 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:21:22.368 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:21:22.369 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 08:21:22.369 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:21:22.403 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:21:22.404 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:21:22.404 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:21:22.407 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:21:22.426 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.433 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:21:22.435 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:21:22.435 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:21:22.436 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:21:22.437 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:21:22.437 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:21:22.443 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.452 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:21:22.454 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:21:22.454 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:21:22.455 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 401
2025-06-22 08:21:22.460 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.469 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:21:22.471 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:21:22.471 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:21:22.476 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.488 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:21:22.490 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:21:22.490 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:21:22.491 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:21:22.496 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.504 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:21:22.529 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.537 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:21:22.549 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.553 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:21:22.558 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.563 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:21:22.564 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:21:22.569 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.573 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:21:22.573 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:21:22.580 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.589 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:21:22.595 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.601 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:21:22.607 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.612 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:21:22.618 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.624 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:21:22.631 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.636 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:21:22.641 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.642 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:21:22.643 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:21:22.644 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:21:22.644 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:21:22.650 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.651 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 08:21:22.652 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 08:21:22.658 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.662 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:21:22.669 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.673 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:21:22.735 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.741 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:21:22.746 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.762 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.769 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.770 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:21:22.771 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:21:22.777 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.779 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:21:22.779 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:21:22.784 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.790 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:21:22.817 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.824 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 08:21:22.829 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:22.836 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:23.027 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:21:23.028 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:23.029 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:21:23.029 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:21:23.029 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:21:23.030 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:21:23.030 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:21:23.056 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:21:23.069 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:21:23.070 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:23.070 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:21:23.070 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:21:23.071 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:21:23.071 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:21:23.072 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:21:23.095 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:21:23.201 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:21:23.208 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:23:16.633 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:23:16.635 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:23:17.141 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:23:17.145 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:17.145 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:23:17.146 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:23:17.153 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {}
2025-06-22 08:23:17.155 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:23:17.159 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:23:17.163 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:23:17.163 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 08:23:17.217 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:23:19.629 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 2 records
2025-06-22 08:23:19.635 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.49 seconds
2025-06-22 08:23:19.636 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:23:19.664 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:23:19.848 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:23:19.849 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:19.850 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:23:19.850 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:23:19.853 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {}
2025-06-22 08:23:19.853 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:23:19.856 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 500
2025-06-22 08:23:19.856 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: API Server Error
2025-06-22 08:23:19.856 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:23:19.857 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:23:19.868 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7f8e4290dee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7f8e4288fce0: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7f8e4290dd00>
           └ <coverage.cmdline.CoverageScript object at 0x7f8e4288eed0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7f8e4290d1c0>
    └ <coverage.execfile.PyRunner object at 0x7f8e42d13410>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7f8e41f32670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7f8e42156160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7f8e434a1940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7f8e42141be0>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f8e41f57fe0>
         │                └ <_pytest.config.Config object at 0x7f8e42141be0>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7f8e42141be0>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7f8e42141be0>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7f8e42746ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f8e423996d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7f8e42141be0>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7f8e422247c0>
           │            └ <_pytest.config.Config object at 0x7f8e42141be0>
           └ <function wrap_session at 0x7f8e42224400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7f8e42141be0>
    │       │            └ <function _main at 0x7f8e422247c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f8e41f57fe0>
    └ <_pytest.config.Config object at 0x7f8e42141be0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7f8e42746ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f8e423996d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7f8e42746ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f8e423996d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7f8e422137e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7f8e42213d80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7f8e422240e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7f8e381128e0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7f8e42746ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f8e423996d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7f8e419a4e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7f8e42182110>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7f8e42746ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f8e423996d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7f8e38d6daf0>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7f8e38113f60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7f8e41c95620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f8e41c95580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f8e41c97380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f8e41c2b880>
    └ <Handle Task.task_wakeup(<Future finis...47867321584'>>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...47867321584'>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...47867321584'>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...47867321584'>>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 181, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7f8e38d13ba0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7f8e38d13740>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f8e004696a0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7f8e38d13920>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f8e004696a0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7f8e38d13880>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f8e004696a0>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7f8e3a7f9e40>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7f8e3b1bb880>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f8e00538aa0>}
           │         └ (<LazyFrame at 0x7F8E005389B0>,)
           └ <function LazyFrame.collect at 0x7f8e3a79c720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f8e185321b0>}
           │         └ (<LazyFrame at 0x7F8E005389B0>,)
           └ <function LazyFrame.collect at 0x7f8e3a79c680>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7f8e1806fab0>
           └ <function wrap_df at 0x7f8e3b15b380>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 08:23:19.937 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:23:19.938 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:23:19.938 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:23:19.975 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 08:23:19.977 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.13 seconds
2025-06-22 08:23:19.978 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 2173.7     ┆ 2332.52     ┆ -158.82    ┆ 3437.0     ┆ 2407.14     ┆ 1029.86    │
│ 2025-06-19 ┆ 4132.31    ┆ 4177.0      ┆ -44.69     ┆ 3329.66    ┆ 2154.34     ┆ 1175.32    │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:23:20.000 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:23:20.049 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:23:20.049 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.050 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:23:20.050 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:23:20.050 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:23:20.051 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:23:20.052 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:23:20.075 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:23:20.098 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:23:20.099 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.106 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmpn6kgow41.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:23:20.106 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:23:20.107 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:23:20.112 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpn6kgow41.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:23:20.133 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:23:20.133 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.136 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:23:20.136 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:23:20.159 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:23:20.180 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:23:20.181 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:23:20.182 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:23:20.182 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:23:20.217 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:23:20.217 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 08:23:20.218 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:23:20.251 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:23:20.252 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:23:20.252 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:23:20.254 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:23:20.275 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.281 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:23:20.284 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:23:20.284 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:23:20.285 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:23:20.285 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:23:20.286 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:23:20.292 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.299 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:23:20.301 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:23:20.301 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:23:20.302 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 401
2025-06-22 08:23:20.307 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.315 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:23:20.317 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:23:20.317 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:23:20.322 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.333 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:23:20.335 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:23:20.335 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:23:20.336 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:23:20.341 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.349 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:23:20.371 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.379 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:23:20.389 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.392 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:23:20.397 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.401 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:23:20.402 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:23:20.406 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.410 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:23:20.411 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:23:20.417 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.423 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:23:20.429 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.434 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:23:20.439 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.444 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:23:20.451 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.456 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:23:20.464 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.469 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:23:20.475 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.476 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:23:20.476 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:23:20.477 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:23:20.478 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:23:20.484 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.485 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 08:23:20.486 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 08:23:20.491 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.496 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:23:20.502 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.506 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:23:20.565 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.569 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:23:20.574 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.593 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.600 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.601 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:23:20.601 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:23:20.608 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.609 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:23:20.609 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:23:20.614 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.620 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:23:20.650 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.656 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 08:23:20.661 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.668 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.902 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:23:20.903 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.903 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:23:20.904 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:23:20.904 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:23:20.904 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:23:20.905 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:23:20.932 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:23:20.944 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:23:20.944 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:20.945 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:23:20.945 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:23:20.945 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:23:20.946 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:23:20.947 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:23:20.968 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:23:21.070 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:23:21.076 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:26:04.232 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:26:04.233 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:26:04.465 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:26:04.466 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:04.466 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:26:04.467 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:26:04.471 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {}
2025-06-22 08:26:04.472 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:26:04.474 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:26:04.475 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:26:04.476 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 08:26:04.485 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:26:05.906 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 2 records
2025-06-22 08:26:05.909 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.44 seconds
2025-06-22 08:26:05.910 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:26:05.933 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:26:06.109 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:26:06.110 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.110 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:26:06.111 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:26:06.114 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {}
2025-06-22 08:26:06.114 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:26:06.117 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 500
2025-06-22 08:26:06.117 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: API Server Error
2025-06-22 08:26:06.118 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:26:06.118 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:26:06.131 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7f1c4a3d1ee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7f1c4a34fe00: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7f1c4a3d1d00>
           └ <coverage.cmdline.CoverageScript object at 0x7f1c4a34ef30>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7f1c4a3d11c0>
    └ <coverage.execfile.PyRunner object at 0x7f1c4a34f4d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7f1c499f2670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7f1c49c1a160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7f1c4af61940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7f1c4a13bc50>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f1c49c01e20>
         │                └ <_pytest.config.Config object at 0x7f1c4a13bc50>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7f1c4a13bc50>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7f1c4a13bc50>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7f1c4a206ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f1c4a3e5a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7f1c4a13bc50>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7f1c49ce47c0>
           │            └ <_pytest.config.Config object at 0x7f1c4a13bc50>
           └ <function wrap_session at 0x7f1c49ce4400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7f1c4a13bc50>
    │       │            └ <function _main at 0x7f1c49ce47c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f1c49c01e20>
    └ <_pytest.config.Config object at 0x7f1c4a13bc50>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7f1c4a206ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f1c4a3e5a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7f1c4a206ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f1c4a3e5a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7f1c49cd37e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7f1c49cd3d80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7f1c49ce40e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7f1c406502c0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7f1c4a206ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f1c4a3e5a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7f1c49464e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7f1c49c42110>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7f1c4a206ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f1c4a3e5a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7f1c4077e900>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7f1c40786700>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7f1c4975d620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f1c4975d580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f1c4975f380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f1c496ef880>
    └ <Handle Task.task_wakeup(<Future finis...59316717968'>>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...59316717968'>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...59316717968'>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...59316717968'>>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 181, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7f1c4073bba0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7f1c4073b740>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f1c0851f1a0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7f1c4073b920>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f1c0851f1a0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7f1c4073b880>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f1c0851f1a0>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7f1c42bfde40>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7f1c434d3880>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f1c235313a0>}
           │         └ (<LazyFrame at 0x7F1C08557350>,)
           └ <function LazyFrame.collect at 0x7f1c42ba0720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f1c219d0ad0>}
           │         └ (<LazyFrame at 0x7F1C08557350>,)
           └ <function LazyFrame.collect at 0x7f1c42ba0680>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7f1c08378030>
           └ <function wrap_df at 0x7f1c43473380>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 08:26:06.166 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:26:06.166 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:26:06.167 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:26:06.186 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 08:26:06.189 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.08 seconds
2025-06-22 08:26:06.190 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 7911.38    ┆ 1917.92     ┆ 5993.46    ┆ 3560.99    ┆ 2931.01     ┆ 629.98     │
│ 2025-06-19 ┆ 2548.98    ┆ 6770.77     ┆ -4221.79   ┆ 2002.03    ┆ 2024.34     ┆ -22.31     │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:26:06.213 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:26:06.267 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:26:06.268 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.268 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:26:06.268 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:26:06.269 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:26:06.269 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:26:06.270 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:26:06.296 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:26:06.318 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:26:06.319 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.327 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmp_r61nmz1.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:26:06.327 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:26:06.328 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:26:06.333 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmp_r61nmz1.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:26:06.356 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:26:06.357 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.359 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:26:06.359 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:26:06.383 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:26:06.395 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:26:06.395 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:26:06.396 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:26:06.397 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:26:06.416 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:26:06.416 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 08:26:06.417 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:26:06.439 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:26:06.439 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:26:06.440 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:26:06.441 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:26:06.456 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.463 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:26:06.465 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:26:06.465 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:26:06.466 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:26:06.467 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:26:06.467 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:26:06.473 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.481 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:26:06.483 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:26:06.483 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:26:06.484 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 401
2025-06-22 08:26:06.489 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.497 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:26:06.500 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:26:06.500 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:26:06.505 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.515 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:26:06.517 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:26:06.518 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:26:06.519 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:26:06.524 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.531 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:26:06.552 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.560 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:26:06.570 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.574 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:26:06.581 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.584 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:26:06.585 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:26:06.590 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.594 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:26:06.594 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:26:06.601 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.607 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:26:06.613 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.618 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:26:06.624 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.628 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:26:06.634 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.640 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:26:06.646 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.651 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:26:06.657 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.658 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:26:06.659 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:26:06.660 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:26:06.660 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:26:06.665 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.667 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 08:26:06.667 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 08:26:06.674 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.679 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:26:06.739 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.743 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:26:06.750 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.754 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:26:06.759 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.773 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.780 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.781 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:26:06.781 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:26:06.787 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.788 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:26:06.789 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:26:06.793 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.800 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:26:06.826 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.831 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 08:26:06.835 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.842 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.988 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:26:06.990 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:06.990 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:26:06.990 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:26:06.991 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:26:06.991 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:26:06.991 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:26:07.017 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:26:07.018 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:26:07.018 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:07.018 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:26:07.019 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:26:07.019 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:26:07.020 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:26:07.021 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:26:07.044 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:26:07.151 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:26:07.158 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:27:08.817 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:27:08.817 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:27:09.060 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:27:09.061 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:09.062 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:27:09.062 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:27:09.067 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {}
2025-06-22 08:27:09.067 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:27:09.070 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:27:09.072 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:27:09.072 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 08:27:09.081 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:27:10.398 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 2 records
2025-06-22 08:27:10.403 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.34 seconds
2025-06-22 08:27:10.404 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:27:10.441 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:27:10.663 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:27:10.664 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:10.664 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:27:10.664 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:27:10.668 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {}
2025-06-22 08:27:10.668 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:27:10.670 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 500
2025-06-22 08:27:10.671 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:163 - API scrape failed: API Server Error
2025-06-22 08:27:10.671 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:27:10.672 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:27:10.684 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:443 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7f3402621ee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7f34025a3ce0: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7f3402621d00>
           └ <coverage.cmdline.CoverageScript object at 0x7f34025a2ed0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7f34026211c0>
    └ <coverage.execfile.PyRunner object at 0x7f3402a27410>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7f3401c46670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7f3401e6a160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7f34031b5940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7f3401e55be0>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f3401c6bfe0>
         │                └ <_pytest.config.Config object at 0x7f3401e55be0>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7f3401e55be0>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7f3401e55be0>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7f340245aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f34020ad6d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7f3401e55be0>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7f3401f387c0>
           │            └ <_pytest.config.Config object at 0x7f3401e55be0>
           └ <function wrap_session at 0x7f3401f38400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7f3401e55be0>
    │       │            └ <function _main at 0x7f3401f387c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f3401c6bfe0>
    └ <_pytest.config.Config object at 0x7f3401e55be0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7f340245aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f34020ad6d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7f340245aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f34020ad6d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7f3401f277e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7f3401f27d80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7f3401f380e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7f33f01502c0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7f340245aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f34020ad6d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7f34016b8e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7f3401e96110>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7f340245aca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f34020ad6d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7f33f80c11f0>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7f33f817a700>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7f34019a9620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f34019a9580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f34019ab380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f340193f880>
    └ <Handle Task.task_wakeup(<Future finis...60453595840'>>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...60453595840'>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...60453595840'>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...60453595840'>>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 181, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7f33f812bba0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 551, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7f33f812b740>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f33d8188cb0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 487, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7f33f812b920>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f33d8188cb0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 309, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7f33f812b880>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f33d8188cb0>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 368, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7f33fadfde40>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7f33fb723880>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f33e7f11fa0>}
           │         └ (<LazyFrame at 0x7F33BC541160>,)
           └ <function LazyFrame.collect at 0x7f33fada4720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f33e7f11580>}
           │         └ (<LazyFrame at 0x7F33BC541160>,)
           └ <function LazyFrame.collect at 0x7f33fada4680>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7f33ccaa7c50>
           └ <function wrap_df at 0x7f33fb6c3380>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 08:27:10.720 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:27:10.720 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:27:10.721 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:27:10.740 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 3 records
2025-06-22 08:27:10.742 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.08 seconds
2025-06-22 08:27:10.743 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 6839.74    ┆ 5249.94     ┆ 1589.8     ┆ 2257.9     ┆ 3274.07     ┆ -1016.17   │
│ 2025-06-19 ┆ 6998.2     ┆ 4613.12     ┆ 2385.08    ┆ 1692.91    ┆ 3510.59     ┆ -1817.68   │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:27:10.766 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:27:10.821 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:27:10.822 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:10.823 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:27:10.823 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:27:10.823 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:27:10.824 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:27:10.824 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:27:10.848 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:27:10.869 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:27:10.870 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:10.877 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:543 - Database update failed: IO Error: The file "/tmp/tmpaow_i4u4.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:27:10.878 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:27:10.878 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:27:10.883 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpaow_i4u4.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:27:10.905 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:27:10.906 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:10.908 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:27:10.908 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:27:10.933 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:27:10.945 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:27:10.946 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:27:10.946 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:27:10.947 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:27:10.970 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:27:10.971 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:555 - Scraping failed completely
2025-06-22 08:27:10.971 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:27:10.995 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:27:10.996 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:27:10.996 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:27:10.997 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:573 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:27:11.014 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.021 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:27:11.023 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:27:11.023 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:27:11.024 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:27:11.025 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:159 - Fetched FII/DII data from API
2025-06-22 08:27:11.025 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:27:11.032 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.040 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:27:11.041 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:27:11.042 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:27:11.043 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 401
2025-06-22 08:27:11.048 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.056 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:27:11.058 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:27:11.058 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:27:11.066 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.073 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:27:11.075 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:27:11.075 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:27:11.077 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:150 - API status: 200
2025-06-22 08:27:11.082 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.089 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:27:11.108 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.116 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:267 - Using Chromium with HTTP/2
2025-06-22 08:27:11.127 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.132 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:27:11.137 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.140 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:27:11.140 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:27:11.145 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.149 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:27:11.149 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:27:11.156 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.162 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 2 records from API
2025-06-22 08:27:11.168 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.173 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:27:11.178 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.183 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:27:11.189 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.195 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:27:11.201 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.206 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:27:11.211 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.212 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:27:11.213 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:27:11.213 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:27:11.214 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:181 - No records in API response
2025-06-22 08:27:11.221 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.222 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'str'>
2025-06-22 08:27:11.222 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:177 - Unexpected API response type: <class 'int'>
2025-06-22 08:27:11.273 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.277 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:27:11.282 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.285 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:27:11.291 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.296 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:253 - Processed 1 records from API
2025-06-22 08:27:11.301 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.316 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.322 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.324 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:27:11.324 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:27:11.330 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.331 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:473 - Generated 3 days of mock data
2025-06-22 08:27:11.332 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:27:11.336 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.342 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:27:11.369 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.373 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:496 - No data to update
2025-06-22 08:27:11.378 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.385 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.511 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:27:11.512 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.513 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:27:11.513 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:27:11.513 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:27:11.513 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:27:11.514 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:27:11.539 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:27:11.540 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:548 - 🚀 Starting FII/DII tracker
2025-06-22 08:27:11.540 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.541 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:482 - Trying official API...
2025-06-22 08:27:11.541 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:486 - API failed, trying Playwright...
2025-06-22 08:27:11.542 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:490 - All scraping methods failed, using mock data
2025-06-22 08:27:11.542 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:557 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:27:11.543 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:560 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:27:11.565 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:581 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:27:11.666 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:27:11.673 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:540 - Updated 1 records
2025-06-22 08:28:10.297 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:28:10.298 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:28:10.603 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:28:10.604 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:10.604 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:28:10.604 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:28:10.613 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {}
2025-06-22 08:28:10.613 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:28:10.618 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:28:10.619 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 08:28:10.620 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 08:28:10.636 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 08:28:12.363 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:541 - Updated 2 records
2025-06-22 08:28:12.367 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 1.76 seconds
2025-06-22 08:28:12.369 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:28:12.403 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:28:12.604 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:28:12.605 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:12.606 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:28:12.606 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:28:12.610 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {}
2025-06-22 08:28:12.610 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:28:12.613 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 08:28:12.614 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 08:28:12.614 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:487 - API failed, trying Playwright...
2025-06-22 08:28:12.615 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 08:28:12.627 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:444 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7f94986c1ee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7f949863fe00: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7f94986c1d00>
           └ <coverage.cmdline.CoverageScript object at 0x7f949863ef30>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7f94986c11c0>
    └ <coverage.execfile.PyRunner object at 0x7f949863f4d0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7f9497ce2670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7f9497f0a160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7f9499251940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7f949842bc50>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f9497d07e90>
         │                └ <_pytest.config.Config object at 0x7f949842bc50>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7f949842bc50>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7f949842bc50>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7f94984f6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f94986d5a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7f949842bc50>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7f9497fd47c0>
           │            └ <_pytest.config.Config object at 0x7f949842bc50>
           └ <function wrap_session at 0x7f9497fd4400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7f949842bc50>
    │       │            └ <function _main at 0x7f9497fd47c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f9497d07e90>
    └ <_pytest.config.Config object at 0x7f949842bc50>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7f94984f6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f94986d5a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7f94984f6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f94986d5a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7f9497fc37e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7f9497fc3d80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7f9497fd40e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7f94874c82c0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7f94984f6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f94986d5a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7f9497754e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7f9497f32110>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7f94984f6ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7f94986d5a60>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7f948747aae0>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7f9487482700>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7f9497a4d620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f9497a4d580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f9497a4f380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f94979df880>
    └ <Handle Task.task_wakeup(<Future finis...75881564048'>>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...75881564048'>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...75881564048'>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...75881564048'>>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 181, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7f948742bba0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 552, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7f948742b740>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f9449f7f9e0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 488, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7f948742b920>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f9449f7f9e0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 310, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7f948742b880>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7f9449f7f9e0>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 369, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7f94905f9e40>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7f9490fbb880>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f9449fb73e0>}
           │         └ (<LazyFrame at 0x7F9449FB7560>,)
           └ <function LazyFrame.collect at 0x7f949059c720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7f9449fb7650>}
           │         └ (<LazyFrame at 0x7F9449FB7560>,)
           └ <function LazyFrame.collect at 0x7f949059c680>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7f94542c3770>
           └ <function wrap_df at 0x7f9490f5b380>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 08:28:12.686 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:491 - All scraping methods failed, using mock data
2025-06-22 08:28:12.686 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - Generated 3 days of mock data
2025-06-22 08:28:12.687 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:475 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:28:12.728 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:541 - Updated 3 records
2025-06-22 08:28:12.731 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 0.13 seconds
2025-06-22 08:28:12.732 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 6301.46    ┆ 2859.38     ┆ 3442.08    ┆ 2695.79    ┆ 3067.11     ┆ -371.32    │
│ 2025-06-19 ┆ 5010.02    ┆ 3693.1      ┆ 1316.92    ┆ 2710.27    ┆ 1581.68     ┆ 1128.59    │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:28:12.759 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:28:12.817 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:28:12.818 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:12.818 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:28:12.819 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:487 - API failed, trying Playwright...
2025-06-22 08:28:12.819 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:491 - All scraping methods failed, using mock data
2025-06-22 08:28:12.820 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:28:12.820 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:28:12.849 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:28:12.872 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:28:12.873 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:12.881 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:544 - Database update failed: IO Error: The file "/tmp/tmplwo3oncg.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:28:12.881 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:28:12.882 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:28:12.888 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmplwo3oncg.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:28:12.911 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:28:12.911 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:12.914 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:28:12.914 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:28:12.941 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:28:12.952 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:28:12.953 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:28:12.954 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:28:12.955 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:574 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:28:12.976 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:28:12.977 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:556 - Scraping failed completely
2025-06-22 08:28:12.977 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:28:13.003 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:28:13.003 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:28:13.004 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:28:13.005 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:574 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:28:13.023 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.029 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:28:13.031 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:28:13.032 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:28:13.033 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:28:13.034 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 08:28:13.034 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:28:13.041 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.048 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:28:13.050 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:28:13.050 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:28:13.052 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 08:28:13.057 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.066 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:28:13.068 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:28:13.069 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:28:13.074 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.085 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:28:13.087 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:28:13.087 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:28:13.088 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:28:13.094 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.102 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:28:13.124 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.132 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 08:28:13.143 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.146 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:28:13.153 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.157 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:28:13.157 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:487 - API failed, trying Playwright...
2025-06-22 08:28:13.162 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.166 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:28:13.166 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:487 - API failed, trying Playwright...
2025-06-22 08:28:13.173 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.180 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 08:28:13.186 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.191 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:28:13.197 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.202 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:28:13.209 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.215 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:28:13.223 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.230 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:28:13.236 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.237 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:28:13.238 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:28:13.239 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:28:13.240 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:28:13.246 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.247 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 08:28:13.248 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 08:28:13.256 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.261 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:28:13.324 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.329 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:28:13.335 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.340 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:28:13.345 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.365 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.372 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.374 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - Generated 3 days of mock data
2025-06-22 08:28:13.374 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:475 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:28:13.381 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.382 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - Generated 3 days of mock data
2025-06-22 08:28:13.382 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:475 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:28:13.387 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.393 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:541 - Updated 1 records
2025-06-22 08:28:13.419 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.424 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:497 - No data to update
2025-06-22 08:28:13.428 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.436 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.630 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:28:13.631 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.632 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:28:13.632 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:487 - API failed, trying Playwright...
2025-06-22 08:28:13.633 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:491 - All scraping methods failed, using mock data
2025-06-22 08:28:13.633 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:28:13.634 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:28:13.665 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:28:13.666 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:28:13.667 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.667 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:28:13.668 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:487 - API failed, trying Playwright...
2025-06-22 08:28:13.668 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:491 - All scraping methods failed, using mock data
2025-06-22 08:28:13.669 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:28:13.669 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:28:13.698 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:28:13.815 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:28:13.823 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:541 - Updated 1 records
2025-06-22 08:29:23.901 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:29:23.902 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:30:27.989 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:30:27.990 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:30:28.210 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:30:28.211 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:28.211 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:30:28.212 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:30:28.216 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 08:30:28.217 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:30:28.219 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:30:28.220 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 08:30:28.221 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 08:30:28.230 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 08:30:29.407 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:541 - Updated 2 records
2025-06-22 08:30:29.410 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 1.20 seconds
2025-06-22 08:30:29.411 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:30:29.437 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:30:29.617 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:30:29.618 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:29.618 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:30:29.619 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:30:29.622 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 08:30:29.622 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:30:29.625 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 08:30:29.625 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 08:30:29.625 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:487 - API failed, trying Playwright...
2025-06-22 08:30:29.626 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 08:30:29.638 | ERROR    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:444 - HTML table parsing failed: column 'fii_buy_cr' is duplicate
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.11/bin/coverage", line 8, in <module>
    sys.exit(main())
    │   │    └ <function main at 0x7fd4eda89ee0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 970, in main
    status = CoverageScript().command_line(argv)
             │                             └ ['run', '--source=quandex_core', '-m', 'pytest', 'tests/']
             └ <class 'coverage.cmdline.CoverageScript'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 681, in command_line
    return self.do_run(options, args)
           │    │      │        └ ['/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py', 'tests/']
           │    │      └ <Values at 0x7fd4eda0b950: {'action': 'run', 'append': None, 'branch': None, 'concurrency': None, 'context': None, 'contexts'...
           │    └ <function CoverageScript.do_run at 0x7fd4eda89d00>
           └ <coverage.cmdline.CoverageScript object at 0x7fd4eda0aba0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/cmdline.py", line 858, in do_run
    runner.run()
    │      └ <function PyRunner.run at 0x7fd4eda891c0>
    └ <coverage.execfile.PyRunner object at 0x7fd4eda0b110>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/coverage/execfile.py", line 211, in run
    exec(code, main_mod.__dict__)
         │     │        └ <member '__dict__' of 'module' objects>
         │     └ <module 'pytest.__main__' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py'>
         └ <code object <module> at 0x7fd4ed096670, file "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
                     │      └ <function console_main at 0x7fd4ed5e6160>
                     └ <module 'pytest' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
           └ <function main at 0x7fd4ee625940>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7fd4ed327350>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fd4ed0bbe30>
         │                └ <_pytest.config.Config object at 0x7fd4ed327350>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7fd4ed327350>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7fd4ed327350>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7fd4ed8c2ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fd4edaad490>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7fd4ed327350>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7fd4ed3947c0>
           │            └ <_pytest.config.Config object at 0x7fd4ed327350>
           └ <function wrap_session at 0x7fd4ed394400>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │       │            │    └ <_pytest.config.Config object at 0x7fd4ed327350>
    │       │            └ <function _main at 0x7fd4ed3947c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 343, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fd4ed0bbe30>
    └ <_pytest.config.Config object at 0x7fd4ed327350>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7fd4ed8c2ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fd4edaad490>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=1 testscollected=37>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │    │                                        └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>, 'nextitem': <Coroutine test_e2e_all_fail_mock_data_path>}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7fd4ed8c2ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fd4edaad490>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>, <Coroutine test_e2e_all_fail_mock_data_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ <Coroutine test_e2e_all_fail_mock_data_path>
    │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    └ <function runtestprotocol at 0x7fd4ed3837e0>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 136, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │       │      └ <function call_and_report at 0x7fd4ed383d80>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/market_insights/test_fii_dii_e2e.py::TestFiiDiiE2EWorkflow::test_e2e_api_fail_playwright_success_path' wh...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 245, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7fd4ed3940e0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7fd4dc8f02c0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 246, in <lambda>
    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
            │                 │       └ {}
            │                 └ <Coroutine test_e2e_api_fail_playwright_success_path>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.11/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7fd4ed8c2ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fd4edaad490>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    item.runtest()
    │    └ <function Coroutine.runtest at 0x7fd4ecb10e00>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 1671, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_e2e_api_fail_playwright_success_path>
    │    └ <property object at 0x7fd4ed2f2160>
    └ <Coroutine test_e2e_api_fail_playwright_success_path>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_e2e_api_fail_playwright_success_path>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7fd4ed8c2ca0>
           └ <_pytest.config.PytestPluginManager object at 0x7fd4edaad490>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_e2e_api_fail_playwright_success_path>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {'mocker': <pytest_mock.plugin.MockerFixture object at 0x7fd4b829ef30>, 'caplog': <_pytest.logging.LogCaptureFixture object a...
             └ <function TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path at 0x7fd4dc8a2700>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    _loop.run_until_complete(task)
    │     │                  └ <Task pending name='Task-3' coro=<TestFiiDiiE2EWorkflow.test_e2e_api_fail_playwright_success_path() running at /app/tests/mar...
    │     └ <function BaseEventLoop.run_until_complete at 0x7fd4ece05620>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fd4ece05580>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fd4ece07380>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fd4ecd97880>
    └ <Handle Task.task_wakeup(<Future finis...51226775632'>>)>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...51226775632'>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...51226775632'>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...51226775632'>>)>

  File "/app/tests/market_insights/test_fii_dii_e2e.py", line 183, in test_e2e_api_fail_playwright_success_path
    await run_tracker_main()
          └ <function main at 0x7fd4dca47ba0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 552, in main
    data = await scraper.scrape()
                 │       └ <function NSE_FII_DII_Scraper.scrape at 0x7fd4dca47740>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fd4a1f91be0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 488, in scrape
    data = await self.scrape_with_playwright()
                 │    └ <function NSE_FII_DII_Scraper.scrape_with_playwright at 0x7fd4dca47920>
                 └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fd4a1f91be0>

  File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 310, in scrape_with_playwright
    return self._parse_html_table(table)
           │    │                 └ <table>
           │    │                   <thead>
           │    │                   <tr><th>Date</th><th>FII Gross Purchase (Rs Cr)</th><th>FII Gross Sales (Rs Cr)</th><th>FII Net Purchase / Sa...
           │    └ <function NSE_FII_DII_Scraper._parse_html_table at 0x7fd4dca47880>
           └ <quandex_core.market_insights.fii_dii_tracker.NSE_FII_DII_Scraper object at 0x7fd4a1f91be0>

> File "/app/quandex_core/market_insights/fii_dii_tracker.py", line 369, in _parse_html_table
    df = df.rename(column_mapping)
         │  │      └ {'Date': 'date', 'FII Gross Purchase (Rs Cr)': 'fii_buy_cr', 'FII Gross Sales (Rs Cr)': 'fii_sell_cr', 'FII Net Purchase / Sa...
         │  └ <function DataFrame.rename at 0x7fd4e59e1e40>
         └ shape: (1, 7)
           ┌─────────────┬──────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
           │ Date    ...

  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/dataframe/frame.py", line 4935, in rename
    .collect(optimizations=QueryOptFlags._eager())
                           │             └ <staticmethod(<function QueryOptFlags._eager at 0x7fd4e63a3880>)>
                           └ <class 'polars.lazyframe.opt_flags.QueryOptFlags'>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/_utils/deprecation.py", line 97, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7fd4a1fd1730>}
           │         └ (<LazyFrame at 0x7FD4A1FD2C00>,)
           └ <function LazyFrame.collect at 0x7fd4e5984720>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/opt_flags.py", line 330, in wrapper
    return function(*args, **kwargs)
           │         │       └ {'optimizations': <polars.lazyframe.opt_flags.QueryOptFlags object at 0x7fd4a1fd2bd0>}
           │         └ (<LazyFrame at 0x7FD4A1FD2C00>,)
           └ <function LazyFrame.collect at 0x7fd4e5984680>
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/polars/lazyframe/frame.py", line 2332, in collect
    return wrap_df(ldf.collect(engine, callback))
           │       │   │       │       └ None
           │       │   │       └ 'auto'
           │       │   └ <method 'collect' of 'builtins.PyLazyFrame' objects>
           │       └ <builtins.PyLazyFrame object at 0x7fd4a1fe81d0>
           └ <function wrap_df at 0x7fd4e6343380>

polars.exceptions.DuplicateError: column 'fii_buy_cr' is duplicate
2025-06-22 08:30:29.701 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:491 - All scraping methods failed, using mock data
2025-06-22 08:30:29.702 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - Generated 3 days of mock data
2025-06-22 08:30:29.702 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:475 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:30:29.741 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:541 - Updated 3 records
2025-06-22 08:30:29.744 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 0.13 seconds
2025-06-22 08:30:29.745 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2025-06-20 ┆ 6317.59    ┆ 4257.55     ┆ 2060.04    ┆ 1741.87    ┆ 3697.63     ┆ -1955.76   │
│ 2025-06-19 ┆ 7413.42    ┆ 4399.82     ┆ 3013.6     ┆ 2461.8     ┆ 2457.27     ┆ 4.53       │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:30:29.768 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:30:29.820 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:30:29.821 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:29.821 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:30:29.822 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:487 - API failed, trying Playwright...
2025-06-22 08:30:29.822 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:491 - All scraping methods failed, using mock data
2025-06-22 08:30:29.822 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:30:29.823 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:30:29.847 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:30:29.868 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:30:29.869 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:29.876 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:544 - Database update failed: IO Error: The file "/tmp/tmp0wvm1hsb.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:30:29.876 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:30:29.877 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:30:29.881 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmp0wvm1hsb.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:30:29.901 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:30:29.901 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:29.904 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:30:29.904 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:30:29.926 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:30:29.936 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:30:29.937 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:30:29.938 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:30:29.938 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:574 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:30:29.961 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:30:29.961 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:556 - Scraping failed completely
2025-06-22 08:30:29.962 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:30:29.984 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:30:29.985 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:30:29.985 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:30:29.986 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:574 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:30:30.002 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.009 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:30:30.012 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:30:30.012 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:30:30.013 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:30:30.014 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 08:30:30.014 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:30:30.020 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.027 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:30:30.029 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:30:30.030 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:30:30.031 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 08:30:30.036 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.046 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:30:30.048 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:30:30.048 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:30:30.056 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.063 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:30:30.065 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:30:30.065 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:30:30.066 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:30:30.071 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.078 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:30:30.100 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.107 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 08:30:30.118 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.123 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:30:30.128 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.131 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:30:30.131 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:487 - API failed, trying Playwright...
2025-06-22 08:30:30.136 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.140 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:30:30.141 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:487 - API failed, trying Playwright...
2025-06-22 08:30:30.147 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.154 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 08:30:30.159 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.164 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:30:30.169 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.174 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:30:30.179 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.184 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:30:30.190 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.195 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:30:30.200 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.201 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:30:30.202 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:30:30.202 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:30:30.203 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:30:30.209 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.211 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 08:30:30.211 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 08:30:30.264 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.268 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:30:30.273 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.276 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:30:30.281 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.285 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:30:30.290 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.307 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.313 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.314 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - Generated 3 days of mock data
2025-06-22 08:30:30.315 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:475 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:30:30.321 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.322 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:474 - Generated 3 days of mock data
2025-06-22 08:30:30.322 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:475 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:30:30.327 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.332 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:541 - Updated 1 records
2025-06-22 08:30:30.357 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.361 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:497 - No data to update
2025-06-22 08:30:30.366 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.372 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.501 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:30:30.502 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.502 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:30:30.502 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:487 - API failed, trying Playwright...
2025-06-22 08:30:30.503 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:491 - All scraping methods failed, using mock data
2025-06-22 08:30:30.503 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:30:30.504 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:30:30.530 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:30:30.531 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:549 - 🚀 Starting FII/DII tracker
2025-06-22 08:30:30.532 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.532 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:483 - Trying official API...
2025-06-22 08:30:30.532 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:487 - API failed, trying Playwright...
2025-06-22 08:30:30.532 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:491 - All scraping methods failed, using mock data
2025-06-22 08:30:30.533 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:558 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:30:30.533 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:561 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:30:30.554 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:582 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:30:30.652 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:30:30.659 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:541 - Updated 1 records
2025-06-22 08:31:26.300 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:31:26.300 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:31:26.513 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:31:26.514 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:26.515 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:31:26.515 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:31:26.520 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 08:31:26.520 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:31:26.522 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:31:26.523 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 08:31:26.524 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 08:31:26.532 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 08:31:27.670 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:559 - Updated 2 records
2025-06-22 08:31:27.675 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 1.16 seconds
2025-06-22 08:31:27.676 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:31:27.699 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:31:27.870 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:31:27.870 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:27.871 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:31:27.871 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:31:27.875 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 08:31:27.875 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:31:27.877 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 08:31:27.877 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 08:31:27.878 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:505 - API failed, trying Playwright...
2025-06-22 08:31:27.878 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 08:31:27.889 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:386 - HTML parsing: Target column 'fii_buy_cr' already mapped. Skipping duplicate mapping for 'FII Net Purchase / Sales (Rs Cr)'.
2025-06-22 08:31:27.890 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:386 - HTML parsing: Target column 'dii_buy_cr' already mapped. Skipping duplicate mapping for 'DII Net Purchase / Sales (Rs Cr)'.
2025-06-22 08:31:27.915 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:562 - Database update failed: Constraint Error: NOT NULL constraint failed: institutional_flows.date
2025-06-22 08:31:27.916 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 0.05 seconds
2025-06-22 08:31:27.917 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (1, 7)
┌──────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---  ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞══════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ null ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└──────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:31:27.939 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:31:27.986 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:31:27.987 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:27.987 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:31:27.988 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:505 - API failed, trying Playwright...
2025-06-22 08:31:27.988 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:509 - All scraping methods failed, using mock data
2025-06-22 08:31:27.988 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:31:27.989 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:31:28.010 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:31:28.030 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:31:28.030 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.037 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:562 - Database update failed: IO Error: The file "/tmp/tmpar6ih0ie.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:31:28.037 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:31:28.038 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:31:28.042 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpar6ih0ie.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:31:28.063 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:31:28.064 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.066 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:31:28.066 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:31:28.087 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:31:28.098 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:31:28.098 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:31:28.099 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:31:28.100 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:592 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:31:28.118 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:31:28.118 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:574 - Scraping failed completely
2025-06-22 08:31:28.119 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:31:28.140 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:31:28.141 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:31:28.141 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:31:28.142 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:592 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:31:28.157 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.163 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:31:28.165 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:31:28.165 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:31:28.166 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:31:28.167 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 08:31:28.167 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:31:28.173 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.179 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:31:28.181 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:31:28.181 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:31:28.182 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 08:31:28.186 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.194 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:31:28.196 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:31:28.196 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:31:28.201 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.210 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:31:28.212 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:31:28.212 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:31:28.213 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:31:28.218 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.225 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:31:28.243 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.250 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 08:31:28.259 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.262 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:31:28.266 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.271 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:31:28.272 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:505 - API failed, trying Playwright...
2025-06-22 08:31:28.276 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.280 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:31:28.281 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:505 - API failed, trying Playwright...
2025-06-22 08:31:28.286 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.292 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 08:31:28.297 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.302 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:31:28.307 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.312 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:31:28.317 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.322 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:31:28.328 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.333 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:31:28.337 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.339 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:31:28.340 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:31:28.340 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:31:28.341 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:31:28.346 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.347 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 08:31:28.347 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 08:31:28.352 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.356 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:31:28.362 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.366 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:31:28.414 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.418 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:31:28.423 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.436 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.443 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.444 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:492 - Generated 3 days of mock data
2025-06-22 08:31:28.444 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:493 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:31:28.450 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.451 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:492 - Generated 3 days of mock data
2025-06-22 08:31:28.452 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:493 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:31:28.456 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.462 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:559 - Updated 1 records
2025-06-22 08:31:28.484 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.490 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:515 - No data to update
2025-06-22 08:31:28.494 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.500 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.620 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:31:28.621 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.622 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:31:28.622 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:505 - API failed, trying Playwright...
2025-06-22 08:31:28.622 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:509 - All scraping methods failed, using mock data
2025-06-22 08:31:28.623 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:31:28.623 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:31:28.649 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:31:28.650 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:31:28.650 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.651 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:31:28.651 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:505 - API failed, trying Playwright...
2025-06-22 08:31:28.652 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:509 - All scraping methods failed, using mock data
2025-06-22 08:31:28.652 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:31:28.653 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:31:28.674 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:31:28.773 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:31:28.780 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:559 - Updated 1 records
2025-06-22 08:33:09.324 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:33:09.325 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:34:41.399 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:34:41.400 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:36:19.825 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:36:19.826 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:36:20.082 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:36:20.083 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.083 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:36:20.084 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:36:20.089 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 08:36:20.089 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:36:20.092 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:36:20.093 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 08:36:20.093 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 08:36:20.106 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 08:36:20.112 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:562 - Database update failed: IO Error: The file "/tmp/tmpbmilnpqq.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:36:20.112 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 0.03 seconds
2025-06-22 08:36:20.113 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:36:20.118 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpbmilnpqq.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:36:20.223 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:36:20.223 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.224 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:36:20.224 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:36:20.227 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 08:36:20.227 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:36:20.230 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 08:36:20.230 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 08:36:20.230 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:505 - API failed, trying Playwright...
2025-06-22 08:36:20.231 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 08:36:20.241 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:386 - HTML parsing: Target column 'fii_buy_cr' already mapped. Skipping duplicate mapping for 'FII Net Purchase / Sales (Rs Cr)'.
2025-06-22 08:36:20.242 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:_parse_html_table:386 - HTML parsing: Target column 'dii_buy_cr' already mapped. Skipping duplicate mapping for 'DII Net Purchase / Sales (Rs Cr)'.
2025-06-22 08:36:20.254 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:562 - Database update failed: IO Error: The file "/tmp/tmprmwq6uq2.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:36:20.255 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 0.03 seconds
2025-06-22 08:36:20.255 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (1, 7)
┌──────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---  ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞══════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ null ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└──────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:36:20.260 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmprmwq6uq2.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:36:20.290 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:36:20.291 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.291 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:36:20.291 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:505 - API failed, trying Playwright...
2025-06-22 08:36:20.292 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:509 - All scraping methods failed, using mock data
2025-06-22 08:36:20.292 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:36:20.293 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:36:20.317 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:36:20.338 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:36:20.338 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.345 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:562 - Database update failed: IO Error: The file "/tmp/tmp4jy1m6i5.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:36:20.345 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:36:20.346 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:36:20.351 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmp4jy1m6i5.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:36:20.372 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:36:20.373 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.375 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:36:20.375 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:36:20.399 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:36:20.410 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:36:20.411 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:36:20.412 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:36:20.412 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:592 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:36:20.430 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:36:20.430 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:574 - Scraping failed completely
2025-06-22 08:36:20.431 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:36:20.451 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:36:20.452 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:36:20.452 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:36:20.453 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:592 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:36:20.469 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.475 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:36:20.477 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:36:20.477 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:36:20.478 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:36:20.479 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 08:36:20.479 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:36:20.485 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.492 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:36:20.494 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:36:20.494 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:36:20.495 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 08:36:20.499 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.508 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:36:20.509 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:36:20.510 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:36:20.515 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.523 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:36:20.526 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:36:20.526 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:36:20.527 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:36:20.532 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.569 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:36:20.587 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.594 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 08:36:20.604 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.608 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:36:20.613 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.616 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:36:20.617 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:505 - API failed, trying Playwright...
2025-06-22 08:36:20.622 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.627 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:36:20.628 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:505 - API failed, trying Playwright...
2025-06-22 08:36:20.634 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.640 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 08:36:20.646 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.650 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:36:20.656 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.660 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:36:20.666 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.671 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:36:20.677 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.682 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:36:20.687 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.688 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:36:20.689 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:36:20.689 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:36:20.690 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:36:20.695 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.696 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 08:36:20.697 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 08:36:20.702 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.706 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:36:20.710 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.714 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:36:20.722 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.726 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:36:20.731 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.745 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.752 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.753 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:492 - Generated 3 days of mock data
2025-06-22 08:36:20.753 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:493 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:36:20.759 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.760 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:492 - Generated 3 days of mock data
2025-06-22 08:36:20.760 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:493 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:36:20.765 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.771 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:559 - Updated 1 records
2025-06-22 08:36:20.796 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.802 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:515 - No data to update
2025-06-22 08:36:20.807 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.814 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.941 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:36:20.942 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.942 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:36:20.943 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:505 - API failed, trying Playwright...
2025-06-22 08:36:20.943 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:509 - All scraping methods failed, using mock data
2025-06-22 08:36:20.944 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:36:20.944 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:36:20.968 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:36:20.969 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:567 - 🚀 Starting FII/DII tracker
2025-06-22 08:36:20.969 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:20.970 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:501 - Trying official API...
2025-06-22 08:36:20.970 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:505 - API failed, trying Playwright...
2025-06-22 08:36:20.970 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:509 - All scraping methods failed, using mock data
2025-06-22 08:36:20.971 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:576 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:36:20.972 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:36:20.993 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:36:21.092 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:36:21.099 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:559 - Updated 1 records
2025-06-22 08:37:51.997 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 08:37:51.997 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 08:37:52.211 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 08:37:52.212 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.212 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 08:37:52.213 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:37:52.217 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 08:37:52.218 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:37:52.220 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:37:52.221 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 08:37:52.222 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 08:37:52.230 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 08:37:52.236 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmpobe9mrjw.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:37:52.236 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.02 seconds
2025-06-22 08:37:52.237 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:37:52.241 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpobe9mrjw.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:37:52.346 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 08:37:52.347 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.347 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 08:37:52.348 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:37:52.351 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 08:37:52.351 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:37:52.353 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 08:37:52.354 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 08:37:52.354 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 08:37:52.354 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 08:37:52.376 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmp475yg80z.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:37:52.376 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.03 seconds
2025-06-22 08:37:52.377 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 7)
┌──────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---  ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞══════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ null ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└──────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:37:52.382 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmp475yg80z.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:37:52.411 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 08:37:52.412 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.412 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 08:37:52.412 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 08:37:52.413 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 08:37:52.413 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:37:52.413 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 08:37:52.437 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:37:52.458 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 08:37:52.458 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.466 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmp3g4oz0gf.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:37:52.466 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.01 seconds
2025-06-22 08:37:52.467 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:37:52.472 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmp3g4oz0gf.db" exists, but it is not a valid DuckDB database file!
2025-06-22 08:37:52.495 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 08:37:52.495 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.498 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:37:52.498 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 08:37:52.524 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:37:52.535 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 08:37:52.536 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 2.50 seconds
2025-06-22 08:37:52.537 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:37:52.537 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:594 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:37:52.558 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 08:37:52.558 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:576 - Scraping failed completely
2025-06-22 08:37:52.558 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 1.00 seconds
2025-06-22 08:37:52.581 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 08:37:52.582 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 1.50 seconds
2025-06-22 08:37:52.583 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 08:37:52.583 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:594 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 08:37:52.600 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.607 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:37:52.609 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:37:52.609 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:37:52.611 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:37:52.611 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 08:37:52.612 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 08:37:52.617 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.625 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:37:52.627 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:37:52.627 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:37:52.628 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 08:37:52.633 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.642 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:37:52.644 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:37:52.644 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:37:52.650 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.658 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:37:52.661 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 08:37:52.662 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 08:37:52.663 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 08:37:52.668 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.705 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 08:37:52.725 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.732 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 08:37:52.743 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.746 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 08:37:52.751 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.754 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 08:37:52.755 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 08:37:52.759 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.765 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 08:37:52.765 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 08:37:52.772 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.777 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 08:37:52.783 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.788 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:37:52.794 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.798 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:37:52.805 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.811 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:37:52.817 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.822 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:37:52.826 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.828 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:37:52.828 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:37:52.829 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:37:52.830 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 08:37:52.835 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.836 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 08:37:52.836 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 08:37:52.841 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.844 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:37:52.849 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.852 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:37:52.859 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.863 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 08:37:52.868 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.882 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.888 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.889 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 08:37:52.889 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:37:52.895 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.896 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 08:37:52.896 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 08:37:52.901 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.906 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:561 - Updated 1 records
2025-06-22 08:37:52.929 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.935 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:517 - No data to update
2025-06-22 08:37:52.939 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:52.945 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:53.074 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 08:37:53.075 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:53.075 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 08:37:53.075 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 08:37:53.076 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 08:37:53.076 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:37:53.076 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:37:53.100 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:37:53.101 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 08:37:53.101 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:53.101 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 08:37:53.102 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 08:37:53.103 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 08:37:53.104 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 08:37:53.104 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 08:37:53.125 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 08:37:53.224 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 08:37:53.231 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:561 - Updated 1 records
2025-06-22 09:11:49.370 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 09:11:49.371 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 09:11:49.685 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:11:49.697 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:49.700 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:11:49.702 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:11:49.709 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 09:11:49.711 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:11:49.716 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:11:49.719 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:11:49.721 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 09:11:49.763 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:11:49.776 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmpv3ysjclr.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:11:49.779 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.08 seconds
2025-06-22 09:11:49.784 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:11:49.792 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpv3ysjclr.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:11:49.939 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:11:49.942 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:49.944 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:11:49.947 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:11:49.952 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 09:11:49.954 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:11:49.958 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 09:11:49.960 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 09:11:49.964 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:11:49.967 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:11:49.996 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmp1jxhz8cl.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:11:49.999 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.06 seconds
2025-06-22 09:11:50.002 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 7)
┌──────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---  ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞══════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ null ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└──────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:11:50.009 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmp1jxhz8cl.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:11:50.064 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:11:50.067 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:50.069 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:11:50.072 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:11:50.074 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:11:50.076 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.01 seconds
2025-06-22 09:11:50.078 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 09:11:50.144 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:11:50.183 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:11:50.186 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:50.196 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmpnrym3qln.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:11:50.199 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.01 seconds
2025-06-22 09:11:50.202 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:11:50.209 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpnrym3qln.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:11:50.246 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:11:50.249 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:50.253 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:11:50.256 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 09:11:50.291 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:11:50.319 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:11:50.683 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:11:50.686 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:576 - Scraping failed completely
2025-06-22 09:11:50.966 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:11:51.232 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.240 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:11:51.242 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:11:51.242 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:11:51.243 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:11:51.244 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:11:51.245 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 09:11:51.251 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.260 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:11:51.293 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:11:51.294 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:11:51.295 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 09:11:51.300 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.309 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:11:51.311 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:11:51.311 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:11:51.316 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.325 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:11:51.327 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:11:51.327 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:11:51.328 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:11:51.334 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.342 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:11:51.362 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.372 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:11:51.383 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.387 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:11:51.392 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.395 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:11:51.396 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:11:51.401 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.405 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:11:51.405 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:11:51.415 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.421 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:11:51.428 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.432 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:11:51.439 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.444 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:11:51.451 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.458 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:11:51.464 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.469 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:11:51.475 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.476 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:11:51.477 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:11:51.478 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:11:51.479 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:11:51.485 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.486 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 09:11:51.486 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 09:11:51.492 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.496 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:11:51.501 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.505 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:11:51.511 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.515 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:11:51.520 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.539 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.546 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.547 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 09:11:51.548 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:11:51.556 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.558 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 09:11:51.558 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:11:51.563 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.569 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:561 - Updated 1 records
2025-06-22 09:11:51.597 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.604 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:517 - No data to update
2025-06-22 09:11:51.610 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.619 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.763 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:11:51.764 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.765 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:11:51.765 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:11:51.766 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:11:51.766 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:11:51.767 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 09:11:51.798 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:11:51.799 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:11:51.800 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.800 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:11:51.800 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:11:51.801 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:11:51.801 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:11:51.802 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 09:11:51.830 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:11:51.945 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:11:51.952 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:561 - Updated 1 records
2025-06-22 09:13:54.098 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 09:13:54.099 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 09:13:54.630 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:13:54.636 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:54.639 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:13:54.642 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:13:54.652 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 09:13:54.654 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:13:54.660 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:13:54.663 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:13:54.665 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 09:13:54.690 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:13:54.702 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmprurw1fhx.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:13:54.706 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.07 seconds
2025-06-22 09:13:54.709 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:13:54.721 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmprurw1fhx.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:13:54.939 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:13:54.943 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:54.945 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:13:54.948 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:13:54.955 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 09:13:54.957 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:13:54.963 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 09:13:54.966 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 09:13:54.969 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:13:54.972 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:13:55.027 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmplyy5fpax.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:13:55.031 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.09 seconds
2025-06-22 09:13:55.034 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 7)
┌──────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---  ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞══════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ null ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└──────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:13:55.046 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmplyy5fpax.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:13:55.144 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:13:55.151 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:55.153 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:13:55.155 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:13:55.165 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:13:55.167 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.02 seconds
2025-06-22 09:13:55.173 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 09:13:55.286 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:13:55.365 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:13:55.371 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:55.393 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmpnnb2s6oa.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:13:55.397 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.03 seconds
2025-06-22 09:13:55.400 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:13:55.412 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpnnb2s6oa.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:13:55.486 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:13:55.490 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:55.497 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.01 seconds
2025-06-22 09:13:55.500 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 09:13:55.561 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:13:55.605 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:13:56.010 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:13:56.012 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:576 - Scraping failed completely
2025-06-22 09:13:56.292 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:13:56.558 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.568 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:13:56.572 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:13:56.573 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:13:56.574 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:13:56.575 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:13:56.575 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 09:13:56.583 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.592 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:13:56.630 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:13:56.630 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:13:56.631 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 09:13:56.636 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.645 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:13:56.647 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:13:56.648 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:13:56.653 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.662 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:13:56.663 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:13:56.664 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:13:56.665 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:13:56.670 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.678 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:13:56.698 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.707 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:13:56.718 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.722 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:13:56.727 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.730 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:13:56.731 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:13:56.736 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.740 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:13:56.741 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:13:56.747 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.754 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:13:56.760 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.766 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:13:56.771 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.776 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:13:56.784 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.789 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:13:56.795 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.800 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:13:56.805 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.806 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:13:56.807 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:13:56.808 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:13:56.808 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:13:56.813 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.815 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 09:13:56.815 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 09:13:56.820 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.824 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:13:56.829 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.832 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:13:56.839 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.843 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:13:56.847 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.863 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.869 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.871 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 09:13:56.871 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:13:56.879 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.880 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 09:13:56.881 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:13:56.885 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.892 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:561 - Updated 1 records
2025-06-22 09:13:56.916 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.922 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:517 - No data to update
2025-06-22 09:13:56.927 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:56.934 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:57.092 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:13:57.093 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:57.094 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:13:57.094 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:13:57.095 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:13:57.095 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:13:57.095 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 09:13:57.123 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:13:57.123 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:13:57.124 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:57.124 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:13:57.125 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:13:57.125 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:13:57.126 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:13:57.127 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 09:13:57.151 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:13:57.266 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:13:57.274 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:561 - Updated 1 records
2025-06-22 09:15:30.345 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 09:15:30.347 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 09:15:30.860 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:15:30.862 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:30.863 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:15:30.864 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:15:30.873 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 09:15:30.874 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:15:30.882 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:15:30.884 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:15:30.885 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 09:15:30.915 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:15:30.926 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmp8seruixr.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:15:30.927 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.07 seconds
2025-06-22 09:15:30.928 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:15:30.938 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmp8seruixr.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:15:31.157 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:15:31.159 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:31.159 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:15:31.160 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:15:31.165 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 09:15:31.166 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:15:31.171 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 09:15:31.172 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 09:15:31.172 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:15:31.173 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:15:31.233 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmp35p2634z.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:15:31.237 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.08 seconds
2025-06-22 09:15:31.239 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 7)
┌──────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---  ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞══════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ null ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└──────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:15:31.248 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmp35p2634z.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:15:31.336 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:15:31.338 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:31.338 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:15:31.339 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:15:31.340 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:15:31.341 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:15:31.342 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 09:15:31.416 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:15:31.484 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:15:31.487 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:31.502 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmpbmwffvu8.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:15:31.504 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.02 seconds
2025-06-22 09:15:31.505 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:15:31.515 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpbmwffvu8.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:15:31.577 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:15:31.578 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:31.583 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:15:31.584 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 09:15:31.631 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:15:31.681 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:15:32.197 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:15:32.199 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:576 - Scraping failed completely
2025-06-22 09:15:32.740 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:15:33.214 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.226 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:15:33.231 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:15:33.232 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:15:33.235 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:15:33.236 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:15:33.236 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 09:15:33.249 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.264 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:15:33.272 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:15:33.273 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:15:33.275 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 09:15:33.289 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.369 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:15:33.373 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:15:33.374 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:15:33.387 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.412 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:15:33.417 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:15:33.419 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:15:33.420 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:15:33.430 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.447 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:15:33.477 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.496 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:15:33.517 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.524 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:15:33.533 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.538 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:15:33.539 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:15:33.547 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.554 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:15:33.556 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:15:33.568 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.586 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:15:33.597 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.611 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:15:33.620 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.640 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:15:33.659 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.671 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:15:33.696 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.710 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:15:33.726 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.731 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:15:33.732 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:15:33.734 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:15:33.735 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:15:33.748 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.750 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 09:15:33.751 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 09:15:33.760 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.769 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:15:33.783 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.793 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:15:33.805 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.817 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:15:33.827 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.861 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.880 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.882 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 09:15:33.883 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:15:33.898 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.901 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 09:15:33.903 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:15:33.909 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.921 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:561 - Updated 1 records
2025-06-22 09:15:33.966 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.976 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:517 - No data to update
2025-06-22 09:15:33.985 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:33.998 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:34.245 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:15:34.248 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:34.249 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:15:34.250 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:15:34.251 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:15:34.251 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:15:34.252 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 09:15:34.300 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:15:34.301 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:15:34.302 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:34.304 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:15:34.305 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:15:34.306 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:15:34.306 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:15:34.307 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 09:15:34.356 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:15:34.556 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:15:34.571 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:561 - Updated 1 records
2025-06-22 09:18:42.006 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 09:18:42.007 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 09:18:42.270 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:18:42.271 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:42.271 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:18:42.272 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:18:42.277 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 09:18:42.278 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:18:42.281 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:18:42.282 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:18:42.282 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 09:18:42.291 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:18:42.297 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmp372opi7p.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:18:42.298 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.03 seconds
2025-06-22 09:18:42.299 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:18:42.304 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmp372opi7p.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:18:42.428 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:18:42.429 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:42.430 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:18:42.430 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:18:42.434 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 09:18:42.434 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:18:42.437 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 09:18:42.438 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 09:18:42.438 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:18:42.439 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:18:42.463 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmpbf4awm1h.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:18:42.464 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.04 seconds
2025-06-22 09:18:42.465 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 7)
┌──────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---  ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞══════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ null ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└──────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:18:42.470 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpbf4awm1h.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:18:42.518 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:18:42.519 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:42.520 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:18:42.520 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:18:42.521 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:18:42.521 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:18:42.522 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 09:18:42.554 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:18:42.590 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:18:42.591 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:42.599 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: IO Error: The file "/tmp/tmpr_1fi1vt.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:18:42.600 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.01 seconds
2025-06-22 09:18:42.601 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:18:42.606 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: IO Error: The file "/tmp/tmpr_1fi1vt.db" exists, but it is not a valid DuckDB database file!
2025-06-22 09:18:42.644 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:18:42.644 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:42.647 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:18:42.648 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 09:18:42.674 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:18:42.699 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:18:42.982 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:18:42.983 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:576 - Scraping failed completely
2025-06-22 09:18:43.270 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:18:43.535 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.543 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:18:43.545 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:18:43.546 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:18:43.547 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:18:43.548 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:18:43.548 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 09:18:43.554 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.562 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:18:43.565 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:18:43.566 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:18:43.567 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 09:18:43.572 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.611 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:18:43.614 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:18:43.614 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:18:43.620 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.628 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:18:43.630 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:18:43.630 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:18:43.631 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:18:43.636 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.644 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:18:43.664 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.673 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:18:43.684 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.688 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:18:43.693 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.697 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:18:43.697 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:18:43.703 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.708 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:18:43.708 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:18:43.716 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.721 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:18:43.728 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.733 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:18:43.740 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.745 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:18:43.751 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.757 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:18:43.765 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.771 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:18:43.776 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.777 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:18:43.778 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:18:43.779 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:18:43.779 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:18:43.785 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.786 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 09:18:43.787 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 09:18:43.793 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.797 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:18:43.802 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.805 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:18:43.811 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.815 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:18:43.820 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.835 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.841 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.843 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 09:18:43.843 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:18:43.851 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.852 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 09:18:43.853 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:18:43.857 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.864 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:561 - Updated 1 records
2025-06-22 09:18:43.889 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.894 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:517 - No data to update
2025-06-22 09:18:43.899 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:43.906 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:44.087 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:18:44.089 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:44.089 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:18:44.090 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:18:44.091 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:18:44.091 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:18:44.092 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 09:18:44.119 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:18:44.120 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:18:44.121 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:44.121 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:18:44.122 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:18:44.123 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:18:44.123 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:18:44.124 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 09:18:44.148 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:18:44.281 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:18:44.289 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:561 - Updated 1 records
2025-06-22 09:23:10.105 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 09:23:10.106 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 09:24:40.161 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 09:24:40.162 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 09:25:51.022 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 09:25:51.023 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 09:25:51.334 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:25:51.336 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:51.337 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:25:51.337 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:25:51.343 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 09:25:51.344 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:25:51.347 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:25:51.348 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:25:51.348 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 09:25:51.363 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:25:53.623 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:561 - Updated 2 records
2025-06-22 09:25:53.669 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 2.33 seconds
2025-06-22 09:25:53.670 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:25:53.701 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: 'DataFrame' object has no attribute 'is_empty'
2025-06-22 09:25:53.906 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:25:53.907 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:53.907 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:25:53.908 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:25:53.912 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 09:25:53.912 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:25:53.915 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 09:25:53.916 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 09:25:53.916 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:25:53.916 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:25:53.966 | ERROR    | quandex_core.market_insights.fii_dii_tracker:update_database:564 - Database update failed: Constraint Error: NOT NULL constraint failed: institutional_flows.date
2025-06-22 09:25:53.967 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.06 seconds
2025-06-22 09:25:53.968 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 7)
┌──────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---  ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞══════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ null ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└──────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:25:53.986 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: 'DataFrame' object has no attribute 'is_empty'
2025-06-22 09:25:54.077 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:25:54.078 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.078 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:25:54.079 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:25:54.079 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:25:54.080 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:25:54.081 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 09:25:54.108 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:25:54.130 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:25:54.131 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.160 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:561 - Updated 2 records
2025-06-22 09:25:54.199 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.07 seconds
2025-06-22 09:25:54.201 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:25:54.221 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: 'DataFrame' object has no attribute 'is_empty'
2025-06-22 09:25:54.277 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:25:54.278 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.280 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:25:54.281 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 09:25:54.307 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:25:54.333 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:25:54.334 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.50 seconds
2025-06-22 09:25:54.334 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:25:54.336 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:594 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 09:25:54.374 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:25:54.375 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:576 - Scraping failed completely
2025-06-22 09:25:54.376 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 2.00 seconds
2025-06-22 09:25:54.414 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:25:54.415 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.50 seconds
2025-06-22 09:25:54.416 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:25:54.417 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:594 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 09:25:54.436 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.443 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:25:54.446 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:25:54.446 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:25:54.447 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:25:54.448 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:25:54.448 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 09:25:54.454 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.462 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:25:54.464 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:25:54.464 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:25:54.466 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 09:25:54.471 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.482 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:25:54.484 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:25:54.484 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:25:54.490 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.499 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:25:54.501 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:25:54.501 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:25:54.503 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:25:54.508 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.516 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:25:54.538 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.546 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:25:54.559 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.563 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:25:54.568 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.571 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:25:54.572 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:25:54.577 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.581 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:25:54.581 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:25:54.588 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.594 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:25:54.600 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.604 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:25:54.610 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.615 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:25:54.622 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.627 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:25:54.633 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.638 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:25:54.645 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.646 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:25:54.647 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:25:54.648 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:25:54.648 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:25:54.707 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.708 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 09:25:54.709 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 09:25:54.715 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.720 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:25:54.724 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.728 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:25:54.735 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.739 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:25:54.744 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.758 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.765 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.767 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 09:25:54.767 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:25:54.773 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.775 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 09:25:54.775 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:25:54.780 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.788 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:561 - Updated 1 records
2025-06-22 09:25:54.817 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.823 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:517 - No data to update
2025-06-22 09:25:54.828 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.835 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.873 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:569 - 🚀 Starting FII/DII tracker
2025-06-22 09:25:54.874 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:25:54.875 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:25:54.875 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:25:54.876 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:25:54.877 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:578 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:25:54.877 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:581 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 09:25:54.907 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:602 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:25:54.938 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:51.051 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 09:54:51.052 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 09:54:51.379 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:570 - 🚀 Starting FII/DII tracker
2025-06-22 09:54:51.381 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:51.382 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:54:51.382 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:54:51.389 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 09:54:51.389 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:54:51.393 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:54:51.394 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:54:51.394 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 09:54:51.438 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:54:53.552 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:562 - Updated 2 records
2025-06-22 09:54:53.571 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - ✅ Tracker completed in 2.19 seconds
2025-06-22 09:54:53.574 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:54:53.611 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:596 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 09:54:53.822 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:570 - 🚀 Starting FII/DII tracker
2025-06-22 09:54:53.823 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:53.824 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:54:53.824 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:54:53.828 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 09:54:53.829 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:54:53.832 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 09:54:53.832 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 09:54:53.833 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:54:53.833 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:54:53.893 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:562 - Updated 1 records
2025-06-22 09:54:53.910 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - ✅ Tracker completed in 0.09 seconds
2025-06-22 09:54:53.911 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - Data sample:
shape: (1, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-25 ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:54:53.945 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:596 - Latest record in DB: {'date': Timestamp('2024-08-25 00:00:00'), 'fii_net_cr': 500.0999999999999, 'dii_net_cr': 400.20000000000005}
2025-06-22 09:54:54.034 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:570 - 🚀 Starting FII/DII tracker
2025-06-22 09:54:54.035 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.036 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:54:54.036 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:54:54.037 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:54:54.038 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:54:54.038 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 09:54:54.076 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:54:54.101 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:570 - 🚀 Starting FII/DII tracker
2025-06-22 09:54:54.101 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.138 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:562 - Updated 2 records
2025-06-22 09:54:54.166 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - ✅ Tracker completed in 0.06 seconds
2025-06-22 09:54:54.170 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:54:54.191 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:596 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 09:54:54.239 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:570 - 🚀 Starting FII/DII tracker
2025-06-22 09:54:54.240 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.243 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:54:54.243 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 09:54:54.272 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:54:54.306 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:570 - 🚀 Starting FII/DII tracker
2025-06-22 09:54:54.307 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - ✅ Tracker completed in 0.10 seconds
2025-06-22 09:54:54.308 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:54:54.309 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: 'DataFrame' object has no attribute 'empty'
2025-06-22 09:54:54.346 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:570 - 🚀 Starting FII/DII tracker
2025-06-22 09:54:54.347 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:577 - Scraping failed completely
2025-06-22 09:54:54.348 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - ✅ Tracker completed in 0.20 seconds
2025-06-22 09:54:54.393 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:570 - 🚀 Starting FII/DII tracker
2025-06-22 09:54:54.394 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - ✅ Tracker completed in 0.10 seconds
2025-06-22 09:54:54.395 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:54:54.396 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: 'DataFrame' object has no attribute 'empty'
2025-06-22 09:54:54.417 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.425 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:54:54.427 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:54:54.427 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:54:54.428 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:54:54.429 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:54:54.430 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 09:54:54.436 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.444 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:54:54.446 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:54:54.447 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:54:54.448 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 09:54:54.453 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.462 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:54:54.464 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:54:54.464 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:54:54.470 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.481 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:54:54.483 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:54:54.483 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:54:54.484 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:54:54.489 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.497 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:54:54.503 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.515 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:54:54.530 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.534 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:54:54.540 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.547 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:54:54.548 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:54:54.554 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.558 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:54:54.559 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:54:54.567 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.573 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:54:54.580 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.585 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:54:54.591 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.596 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:54:54.602 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.607 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:54:54.614 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.619 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:54:54.624 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.625 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:54:54.626 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:54:54.627 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:54:54.628 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:54:54.633 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.634 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 09:54:54.635 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 09:54:54.640 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.645 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:54:54.653 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.716 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:54:54.723 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.728 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:54:54.734 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.789 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.797 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.799 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 09:54:54.799 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:54:54.806 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.807 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:494 - Generated 3 days of mock data
2025-06-22 09:54:54.808 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:495 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:54:54.813 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:54.820 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:562 - Updated 1 records
2025-06-22 09:54:55.018 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:55.025 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:517 - No data to update
2025-06-22 09:54:55.030 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:55.037 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:55.074 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:570 - 🚀 Starting FII/DII tracker
2025-06-22 09:54:55.075 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:54:55.076 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:503 - Trying official API...
2025-06-22 09:54:55.077 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:507 - API failed, trying Playwright...
2025-06-22 09:54:55.077 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:511 - All scraping methods failed, using mock data
2025-06-22 09:54:55.078 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:579 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:54:55.078 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 09:54:55.108 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:600 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:54:55.128 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:16.423 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 09:58:16.423 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 09:58:16.752 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 09:58:16.754 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:16.754 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 09:58:16.755 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:58:16.761 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 09:58:16.761 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:58:16.765 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:58:16.766 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:58:16.766 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 09:58:16.794 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:58:18.545 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 2 records
2025-06-22 09:58:18.591 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 1.84 seconds
2025-06-22 09:58:18.593 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:58:18.620 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 09:58:18.828 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 09:58:18.829 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:18.830 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 09:58:18.830 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:58:18.834 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 09:58:18.834 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:58:18.837 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 09:58:18.837 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 09:58:18.838 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 09:58:18.838 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:58:18.916 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 1 records
2025-06-22 09:58:18.936 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.11 seconds
2025-06-22 09:58:18.937 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-25 ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:58:18.955 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-25 00:00:00'), 'fii_net_cr': 500.0999999999999, 'dii_net_cr': 400.20000000000005}
2025-06-22 09:58:19.028 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 09:58:19.029 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.029 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 09:58:19.030 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 09:58:19.030 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:514 - All scraping methods failed, using mock data
2025-06-22 09:58:19.031 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:58:19.032 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 09:58:19.063 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:58:19.084 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 09:58:19.085 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.112 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 2 records
2025-06-22 09:58:19.155 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.07 seconds
2025-06-22 09:58:19.156 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:58:19.174 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 09:58:19.216 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 09:58:19.216 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.219 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:58:19.220 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 09:58:19.244 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:58:19.268 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 09:58:19.269 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.10 seconds
2025-06-22 09:58:19.269 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:58:19.270 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: 'DataFrame' object has no attribute 'empty'
2025-06-22 09:58:19.306 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 09:58:19.307 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:580 - Scraping failed completely
2025-06-22 09:58:19.308 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.99 seconds
2025-06-22 09:58:19.344 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 09:58:19.345 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 1.49 seconds
2025-06-22 09:58:19.345 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 09:58:19.346 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: 'DataFrame' object has no attribute 'empty'
2025-06-22 09:58:19.366 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.373 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:58:19.375 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:58:19.375 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:58:19.376 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:58:19.377 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 09:58:19.377 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 09:58:19.383 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.391 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:58:19.393 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:58:19.393 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:58:19.394 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 09:58:19.399 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.410 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:58:19.412 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:58:19.412 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:58:19.418 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.426 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:58:19.428 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 09:58:19.428 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 09:58:19.429 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 09:58:19.434 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.443 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 09:58:19.448 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.456 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 09:58:19.470 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.473 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 09:58:19.478 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.482 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 09:58:19.482 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 09:58:19.487 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.491 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 09:58:19.491 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 09:58:19.498 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.504 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 09:58:19.510 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.515 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:58:19.521 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.526 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:58:19.532 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.538 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:58:19.544 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.548 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:58:19.554 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.555 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:58:19.556 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:58:19.557 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:58:19.558 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 09:58:19.565 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.566 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 09:58:19.567 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 09:58:19.625 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.629 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:58:19.634 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.638 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:58:19.644 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.648 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 09:58:19.654 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.669 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.676 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.677 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:497 - Generated 3 days of mock data
2025-06-22 09:58:19.678 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:498 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:58:19.684 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.686 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:497 - Generated 3 days of mock data
2025-06-22 09:58:19.686 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:498 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 09:58:19.691 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.698 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 1 records
2025-06-22 09:58:19.705 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.710 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:520 - No data to update
2025-06-22 09:58:19.714 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.721 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.754 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 09:58:19.757 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 09:58:19.758 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 09:58:19.758 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 09:58:19.759 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:514 - All scraping methods failed, using mock data
2025-06-22 09:58:19.759 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.00 seconds
2025-06-22 09:58:19.760 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 09:58:19.788 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 09:58:19.807 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:33.725 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 10:00:33.725 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 10:00:34.070 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:00:34.077 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:34.078 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:00:34.079 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:00:34.087 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 10:00:34.088 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:00:34.093 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:00:34.094 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 10:00:34.095 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 10:00:34.122 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 10:00:36.969 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 2 records
2025-06-22 10:00:37.043 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 2.97 seconds
2025-06-22 10:00:37.046 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:00:37.101 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 10:00:37.241 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:00:37.244 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:37.246 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:00:37.247 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:00:37.252 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 10:00:37.253 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:00:37.259 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 10:00:37.261 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 10:00:37.262 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:00:37.263 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 10:00:37.406 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 1 records
2025-06-22 10:00:37.450 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.21 seconds
2025-06-22 10:00:37.453 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-25 ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:00:37.499 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-25 00:00:00'), 'fii_net_cr': 500.0999999999999, 'dii_net_cr': 400.20000000000005}
2025-06-22 10:00:37.620 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:00:37.621 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:37.622 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:00:37.623 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:00:37.623 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:514 - All scraping methods failed, using mock data
2025-06-22 10:00:37.624 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.00 seconds
2025-06-22 10:00:37.625 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 10:00:37.681 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:00:37.722 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:00:37.725 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:37.797 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 2 records
2025-06-22 10:00:37.846 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.12 seconds
2025-06-22 10:00:37.849 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:00:37.892 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 10:00:38.009 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:00:38.010 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:38.020 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.01 seconds
2025-06-22 10:00:38.023 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 10:00:38.076 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:00:38.133 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:00:38.136 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.10 seconds
2025-06-22 10:00:38.138 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:00:38.141 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: 'DataFrame' object has no attribute 'empty'
2025-06-22 10:00:38.442 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:00:38.444 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:580 - Scraping failed completely
2025-06-22 10:00:38.447 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.20 seconds
2025-06-22 10:00:38.526 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:00:38.530 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.10 seconds
2025-06-22 10:00:38.531 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:00:38.533 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: 'DataFrame' object has no attribute 'empty'
2025-06-22 10:00:38.575 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:38.598 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:00:38.603 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:00:38.603 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:00:38.608 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:00:38.609 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 10:00:38.610 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 10:00:38.623 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:38.643 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:00:38.650 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:00:38.650 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:00:38.656 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 10:00:38.667 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:38.683 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:00:38.690 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:00:38.690 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:00:38.706 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:38.721 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:00:38.728 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:00:38.729 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:00:38.730 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:00:38.745 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:38.763 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:00:38.779 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:38.802 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 10:00:38.822 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:38.829 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:00:38.837 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:38.843 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:00:38.843 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:00:38.852 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:38.865 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:00:38.865 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:00:38.883 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:38.900 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 10:00:38.924 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:38.939 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:00:38.958 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:38.978 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:00:38.999 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.022 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:00:39.035 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.051 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:00:39.066 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.071 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:00:39.073 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:00:39.074 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:00:39.075 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:00:39.084 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.087 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 10:00:39.088 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 10:00:39.096 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.103 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:00:39.122 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.128 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:00:39.144 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.158 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:00:39.167 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.285 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.297 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.299 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:497 - Generated 3 days of mock data
2025-06-22 10:00:39.301 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:498 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 10:00:39.315 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.318 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:497 - Generated 3 days of mock data
2025-06-22 10:00:39.318 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:498 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 10:00:39.326 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.339 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 1 records
2025-06-22 10:00:39.349 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.359 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:520 - No data to update
2025-06-22 10:00:39.369 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.383 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.447 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:00:39.452 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:00:39.453 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:00:39.455 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:00:39.457 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:514 - All scraping methods failed, using mock data
2025-06-22 10:00:39.459 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.01 seconds
2025-06-22 10:00:39.460 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 10:00:39.529 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:00:39.567 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:27.563 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 10:02:27.564 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 10:02:27.860 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:02:27.861 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:27.862 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:02:27.862 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:02:27.868 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 10:02:27.868 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:02:27.871 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:02:27.872 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 10:02:27.873 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 10:02:27.886 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 10:02:29.622 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 2 records
2025-06-22 10:02:29.641 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 1.78 seconds
2025-06-22 10:02:29.642 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:02:29.665 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 10:02:29.725 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:02:29.726 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:29.726 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:02:29.727 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:02:29.730 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 10:02:29.731 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:02:29.733 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 10:02:29.734 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 10:02:29.734 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:02:29.735 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 10:02:29.781 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 1 records
2025-06-22 10:02:29.792 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.07 seconds
2025-06-22 10:02:29.793 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-25 ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:02:29.812 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-25 00:00:00'), 'fii_net_cr': 500.0999999999999, 'dii_net_cr': 400.20000000000005}
2025-06-22 10:02:29.869 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:02:29.870 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:29.871 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:02:29.872 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:02:29.873 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:514 - All scraping methods failed, using mock data
2025-06-22 10:02:29.873 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.00 seconds
2025-06-22 10:02:29.874 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 10:02:29.905 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:02:29.929 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:02:29.930 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:29.960 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 2 records
2025-06-22 10:02:29.974 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.04 seconds
2025-06-22 10:02:29.975 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:02:29.999 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 10:02:30.049 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:02:30.050 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:30.053 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.00 seconds
2025-06-22 10:02:30.054 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 10:02:30.080 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:02:30.105 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:02:30.558 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:02:30.559 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:580 - Scraping failed completely
2025-06-22 10:02:30.846 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:02:31.114 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.122 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:02:31.124 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:02:31.125 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:02:31.126 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:02:31.127 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 10:02:31.127 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 10:02:31.133 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.140 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:02:31.142 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:02:31.143 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:02:31.144 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 10:02:31.148 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.157 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:02:31.161 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:02:31.161 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:02:31.166 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.175 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:02:31.176 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:02:31.177 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:02:31.178 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:02:31.183 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.191 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:02:31.196 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.203 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 10:02:31.214 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.220 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:02:31.224 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.228 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:02:31.228 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:02:31.233 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.238 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:02:31.238 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:02:31.245 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.250 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 10:02:31.256 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.261 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:02:31.267 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.271 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:02:31.277 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.283 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:02:31.289 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.293 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:02:31.298 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.299 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:02:31.300 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:02:31.301 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:02:31.301 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:02:31.307 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.308 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 10:02:31.308 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 10:02:31.315 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.319 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:02:31.379 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.383 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:02:31.389 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.394 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:02:31.399 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.414 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.420 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.421 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:497 - Generated 3 days of mock data
2025-06-22 10:02:31.422 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:498 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 10:02:31.428 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.429 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:497 - Generated 3 days of mock data
2025-06-22 10:02:31.430 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:498 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 10:02:31.434 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.441 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 1 records
2025-06-22 10:02:31.449 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.454 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:520 - No data to update
2025-06-22 10:02:31.458 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.466 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.498 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:02:31.500 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:02:31.500 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:02:31.501 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:02:31.502 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:514 - All scraping methods failed, using mock data
2025-06-22 10:02:31.502 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.00 seconds
2025-06-22 10:02:31.503 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 10:02:31.531 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:02:31.554 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:07.255 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 10:04:07.256 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 10:04:08.935 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:04:08.937 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:08.937 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:04:08.938 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:04:08.943 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 10:04:08.943 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:04:08.946 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:04:08.947 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 10:04:08.948 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 10:04:08.959 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 10:04:09.009 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 2 records
2025-06-22 10:04:09.029 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.09 seconds
2025-06-22 10:04:09.029 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:04:09.053 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 10:04:09.106 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:04:09.106 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:09.107 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:04:09.108 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:04:09.111 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 10:04:09.111 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:04:09.114 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 10:04:09.115 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 10:04:09.115 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:04:09.115 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 10:04:09.155 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 1 records
2025-06-22 10:04:09.164 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.06 seconds
2025-06-22 10:04:09.165 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-25 ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:04:09.182 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-25 00:00:00'), 'fii_net_cr': 500.0999999999999, 'dii_net_cr': 400.20000000000005}
2025-06-22 10:04:09.234 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:04:09.235 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:09.235 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:04:09.236 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:04:09.236 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:514 - All scraping methods failed, using mock data
2025-06-22 10:04:09.237 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.00 seconds
2025-06-22 10:04:09.237 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 10:04:09.261 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:04:09.281 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:04:09.282 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:09.307 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 2 records
2025-06-22 10:04:09.319 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.04 seconds
2025-06-22 10:04:09.321 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:04:09.338 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 10:04:09.378 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:04:09.379 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:09.383 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.00 seconds
2025-06-22 10:04:09.384 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 10:04:09.407 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:04:09.431 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:04:09.864 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:04:09.865 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:580 - Scraping failed completely
2025-06-22 10:04:10.142 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:04:10.400 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.407 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:04:10.409 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:04:10.410 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:04:10.411 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:04:10.411 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 10:04:10.412 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 10:04:10.418 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.425 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:04:10.428 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:04:10.428 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:04:10.429 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 10:04:10.434 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.442 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:04:10.444 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:04:10.444 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:04:10.449 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.459 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:04:10.461 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:04:10.461 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:04:10.462 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:04:10.468 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.476 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:04:10.481 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.488 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 10:04:10.499 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.503 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:04:10.509 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.512 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:04:10.512 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:04:10.517 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.521 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:04:10.522 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:04:10.529 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.534 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 10:04:10.541 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.545 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:04:10.552 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.556 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:04:10.562 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.567 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:04:10.573 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.578 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:04:10.583 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.584 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:04:10.585 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:04:10.586 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:04:10.586 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:04:10.591 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.593 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 10:04:10.593 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 10:04:10.600 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.604 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:04:10.657 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.661 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:04:10.667 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.671 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:04:10.676 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.691 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.697 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.699 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:497 - Generated 3 days of mock data
2025-06-22 10:04:10.699 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:498 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 10:04:10.706 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.707 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:497 - Generated 3 days of mock data
2025-06-22 10:04:10.707 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:498 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 10:04:10.713 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.720 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 1 records
2025-06-22 10:04:10.726 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.734 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:520 - No data to update
2025-06-22 10:04:10.739 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.746 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.782 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:04:10.783 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:04:10.784 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:04:10.785 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:04:10.785 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:514 - All scraping methods failed, using mock data
2025-06-22 10:04:10.786 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.00 seconds
2025-06-22 10:04:10.787 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 10:04:10.817 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:04:10.838 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:11.951 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 10:06:11.952 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 10:06:13.513 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:06:13.514 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:13.515 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:06:13.515 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:06:13.520 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 10:06:13.521 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:06:13.524 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:06:13.525 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 10:06:13.526 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 10:06:13.535 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 10:06:13.598 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 2 records
2025-06-22 10:06:13.612 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.10 seconds
2025-06-22 10:06:13.614 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:06:13.636 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 10:06:13.694 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:06:13.695 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:13.695 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:06:13.696 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:06:13.700 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 10:06:13.700 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:06:13.703 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 10:06:13.703 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 10:06:13.704 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:06:13.704 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 10:06:13.747 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 1 records
2025-06-22 10:06:13.756 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.06 seconds
2025-06-22 10:06:13.757 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-25 ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:06:13.775 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-25 00:00:00'), 'fii_net_cr': 500.0999999999999, 'dii_net_cr': 400.20000000000005}
2025-06-22 10:06:13.831 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:06:13.832 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:13.832 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:06:13.833 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:06:13.833 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:514 - All scraping methods failed, using mock data
2025-06-22 10:06:13.834 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.00 seconds
2025-06-22 10:06:13.835 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 10:06:13.861 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:06:13.883 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:06:13.884 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:13.909 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 2 records
2025-06-22 10:06:13.920 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.04 seconds
2025-06-22 10:06:13.922 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:06:13.939 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 10:06:13.983 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:06:13.984 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:13.989 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.01 seconds
2025-06-22 10:06:13.990 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 10:06:14.015 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:06:14.040 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:06:14.041 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 2.49 seconds
2025-06-22 10:06:14.042 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:06:14.044 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 10:06:14.214 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:06:14.215 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:580 - Scraping failed completely
2025-06-22 10:06:14.216 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.99 seconds
2025-06-22 10:06:14.254 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:06:14.255 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 1.49 seconds
2025-06-22 10:06:14.256 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:06:14.258 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 10:06:14.279 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.286 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:06:14.290 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:06:14.290 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:06:14.292 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:06:14.292 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 10:06:14.293 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 10:06:14.299 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.306 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:06:14.308 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:06:14.309 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:06:14.310 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 10:06:14.315 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.324 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:06:14.325 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:06:14.326 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:06:14.331 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.340 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:06:14.342 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:06:14.342 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:06:14.343 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:06:14.349 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.357 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:06:14.365 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.372 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 10:06:14.383 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.387 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:06:14.392 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.396 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:06:14.396 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:06:14.401 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.405 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:06:14.406 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:06:14.413 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.419 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 10:06:14.427 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.432 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:06:14.438 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.442 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:06:14.448 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.454 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:06:14.460 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.464 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:06:14.470 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.471 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:06:14.472 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:06:14.473 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:06:14.473 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:06:14.478 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.480 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 10:06:14.480 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 10:06:14.486 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.490 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:06:14.494 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.498 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:06:14.504 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.508 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:06:14.514 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.531 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.589 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.590 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:497 - Generated 3 days of mock data
2025-06-22 10:06:14.591 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:498 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 10:06:14.597 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.599 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:497 - Generated 3 days of mock data
2025-06-22 10:06:14.599 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:498 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 10:06:14.604 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.611 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 1 records
2025-06-22 10:06:14.617 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.622 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:520 - No data to update
2025-06-22 10:06:14.627 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.634 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.669 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:06:14.670 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:06:14.670 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:06:14.671 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:06:14.672 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:514 - All scraping methods failed, using mock data
2025-06-22 10:06:14.672 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.00 seconds
2025-06-22 10:06:14.673 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 10:06:14.702 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:06:14.721 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:06.622 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:67 - Logging system initialized
2025-06-22 10:08:06.624 | INFO     | quandex_core.market_insights.fii_dii_tracker:<module>:68 - DuckDB path: /app/data_vault/market_boards/quandex.duckdb
2025-06-22 10:08:09.803 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:08:09.806 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:09.808 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:08:09.810 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:08:09.821 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e': 'val_from_session_mock'}
2025-06-22 10:08:09.822 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:08:09.826 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:08:09.828 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 10:08:09.832 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '1,000.50', 'fiiSell': '500.25', 'diiBuy': '700.00', 'diiSell': '300.75'}, {'tradedDate': '27-Aug-2024', 'fiiBuy': '1,200.00', 'fiiSell': '600.00', 'diiBuy': '800.00', 'diiSell': '400.00'}]}...
2025-06-22 10:08:09.879 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 10:08:10.035 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 2 records
2025-06-22 10:08:10.104 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.30 seconds
2025-06-22 10:08:10.107 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:08:10.165 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 10:08:10.297 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:08:10.298 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:10.299 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:08:10.301 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_e2e_user_agent', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:08:10.308 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'session_cookie_e2e_playwright': 'val_from_session_mock'}
2025-06-22 10:08:10.309 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:08:10.313 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 500
2025-06-22 10:08:10.315 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:164 - API scrape failed: API Server Error
2025-06-22 10:08:10.316 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:08:10.318 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 10:08:10.417 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 1 records
2025-06-22 10:08:10.454 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.16 seconds
2025-06-22 10:08:10.457 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-25 ┆ 2000.1     ┆ 1500.0      ┆ 500.1      ┆ 1700.2     ┆ 1300.0      ┆ 400.2      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:08:10.501 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-25 00:00:00'), 'fii_net_cr': 500.0999999999999, 'dii_net_cr': 400.20000000000005}
2025-06-22 10:08:10.621 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:08:10.624 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:10.626 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:08:10.627 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:08:10.628 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:514 - All scraping methods failed, using mock data
2025-06-22 10:08:10.629 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.01 seconds
2025-06-22 10:08:10.630 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 1.0        │
└────────────┴────────────┘
2025-06-22 10:08:10.679 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:08:10.710 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:08:10.711 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:10.771 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 2 records
2025-06-22 10:08:10.812 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.10 seconds
2025-06-22 10:08:10.818 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:08:10.866 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': Timestamp('2024-08-27 00:00:00'), 'fii_net_cr': 600.0, 'dii_net_cr': 400.0}
2025-06-22 10:08:10.960 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:08:10.963 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:10.971 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.01 seconds
2025-06-22 10:08:10.972 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (0, 0)
┌┐
╞╡
└┘
2025-06-22 10:08:11.027 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:08:11.074 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:08:11.075 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 1002.50 seconds
2025-06-22 10:08:11.077 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:08:11.082 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 10:08:11.383 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:08:11.386 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:580 - Scraping failed completely
2025-06-22 10:08:11.387 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 1001.00 seconds
2025-06-22 10:08:11.456 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:08:11.459 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 1001.50 seconds
2025-06-22 10:08:11.461 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (2, 7)
┌────────────┬────────────┬─────────────┬────────────┬────────────┬─────────────┬────────────┐
│ date       ┆ fii_buy_cr ┆ fii_sell_cr ┆ fii_net_cr ┆ dii_buy_cr ┆ dii_sell_cr ┆ dii_net_cr │
│ ---        ┆ ---        ┆ ---         ┆ ---        ┆ ---        ┆ ---         ┆ ---        │
│ date       ┆ f64        ┆ f64         ┆ f64        ┆ f64        ┆ f64         ┆ f64        │
╞════════════╪════════════╪═════════════╪════════════╪════════════╪═════════════╪════════════╡
│ 2024-08-26 ┆ 1000.5     ┆ 500.25      ┆ 500.25     ┆ 700.0      ┆ 300.75      ┆ 399.25     │
│ 2024-08-27 ┆ 1200.0     ┆ 600.0       ┆ 600.0      ┆ 800.0      ┆ 400.0       ┆ 400.0      │
└────────────┴────────────┴─────────────┴────────────┴────────────┴─────────────┴────────────┘
2025-06-22 10:08:11.466 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:main:599 - Latest record in DB: {'date': datetime.date(2024, 1, 1), 'fii_net_cr': 0.0, 'dii_net_cr': 0.0}
2025-06-22 10:08:11.500 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.514 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:08:11.522 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:08:11.523 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:08:11.525 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:08:11.527 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:160 - Fetched FII/DII data from API
2025-06-22 10:08:11.527 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:161 - API response snippet: {'fiiDii': [{'tradedDate': '26-Aug-2024', 'fiiBuy': '100'}]}...
2025-06-22 10:08:11.542 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.559 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:08:11.564 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:08:11.565 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:08:11.567 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 401
2025-06-22 10:08:11.575 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.590 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:08:11.594 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:08:11.595 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:08:11.605 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.620 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:08:11.624 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:132 - Session cookies after home page: {'bm_sv_session_cookie': 'mock_val'}
2025-06-22 10:08:11.624 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:133 - NSE session established via home page.
2025-06-22 10:08:11.626 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:151 - API status: 200
2025-06-22 10:08:11.636 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.651 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_api:113 - Initial request headers: {'User-Agent': 'test_user_agent_scraping', 'Accept': 'application/json, text/plain, */*', 'Accept-Language': 'en-US,en;q=0.9', 'Referer': 'https://www.nseindia.com/', 'Connection': 'keep-alive', 'Cookie': '', 'X-Requested-With': 'XMLHttpRequest'}
2025-06-22 10:08:11.669 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.682 | DEBUG    | quandex_core.market_insights.fii_dii_tracker:scrape_with_playwright:268 - Using Chromium with HTTP/2
2025-06-22 10:08:11.703 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.710 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:08:11.718 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.725 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:08:11.727 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:08:11.735 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.742 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:08:11.745 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:08:11.756 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.776 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 2 records from API
2025-06-22 10:08:11.801 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.815 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:08:11.826 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.836 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:08:11.848 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.861 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:08:11.872 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.883 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:08:11.898 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.900 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:08:11.901 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:08:11.902 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:08:11.903 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:182 - No records in API response
2025-06-22 10:08:11.913 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.916 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'str'>
2025-06-22 10:08:11.918 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_process_api_data:178 - Unexpected API response type: <class 'int'>
2025-06-22 10:08:11.927 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.939 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:08:11.950 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.960 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:08:11.971 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:11.988 | INFO     | quandex_core.market_insights.fii_dii_tracker:_process_api_data:254 - Processed 1 records from API
2025-06-22 10:08:11.997 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:12.033 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:12.136 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:12.139 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:497 - Generated 3 days of mock data
2025-06-22 10:08:12.140 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:498 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 10:08:12.153 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:12.155 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:497 - Generated 3 days of mock data
2025-06-22 10:08:12.157 | WARNING  | quandex_core.market_insights.fii_dii_tracker:_generate_mock_data:498 - ⚠️ WARNING: Using mock data as fallback. Check your scraping setup.
2025-06-22 10:08:12.166 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:12.177 | SUCCESS  | quandex_core.market_insights.fii_dii_tracker:update_database:565 - Updated 1 records
2025-06-22 10:08:12.187 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:12.197 | WARNING  | quandex_core.market_insights.fii_dii_tracker:update_database:520 - No data to update
2025-06-22 10:08:12.205 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:12.218 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:12.281 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:573 - 🚀 Starting FII/DII tracker
2025-06-22 10:08:12.285 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
2025-06-22 10:08:12.286 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:506 - Trying official API...
2025-06-22 10:08:12.287 | INFO     | quandex_core.market_insights.fii_dii_tracker:scrape:510 - API failed, trying Playwright...
2025-06-22 10:08:12.288 | ERROR    | quandex_core.market_insights.fii_dii_tracker:scrape:514 - All scraping methods failed, using mock data
2025-06-22 10:08:12.289 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:582 - ✅ Tracker completed in 0.01 seconds
2025-06-22 10:08:12.290 | INFO     | quandex_core.market_insights.fii_dii_tracker:main:585 - Data sample:
shape: (1, 2)
┌────────────┬────────────┐
│ date       ┆ fii_buy_cr │
│ ---        ┆ ---        │
│ date       ┆ f64        │
╞════════════╪════════════╡
│ 2025-06-22 ┆ 10.0       │
└────────────┴────────────┘
2025-06-22 10:08:12.365 | ERROR    | quandex_core.market_insights.fii_dii_tracker:main:603 - Failed to fetch or log latest record from DB: Catalog Error: Table with name institutional_flows does not exist!
Did you mean "duckdb_constraints"?

LINE 3:                     FROM institutional_flows
                                 ^
2025-06-22 10:08:12.420 | INFO     | quandex_core.market_insights.fii_dii_tracker:__init__:101 - FII/DII scraper initialized
